{"version":3,"sources":["webpack:///webpack/bootstrap 59714b1460a612149056","webpack:///./src/index.js","webpack:///./src/image-editor.js","webpack:///./src/utils.js"],"names":["window","imageEditor","imagePath","imageAltText","onWorkSpaceUpdated","document","querySelector","newImageEditorState","croppedImageObj","croppedImageAtag","previewImage","canvas","toDataURL","src","width","cropped","height","href","template","original","rotated","innerHTML","NAMESPACE","IMAGE_ALT_TEXT","EDITOR_GUTTER","DEBUG","ImageEditor","props","container","image","transform","ratio","translateX","translateY","degrees","radians","origin","position","left","top","drag","startX","startY","dx","dy","maxRatio","croppingArea","maxDimensions","minDimensions","right","bottom","touched","constrain","outerContainer","imageObjClone","onImageLoaded","bind","updateWorkspace","onWindowResize","onStartDragCropArea","onDragCropArea","onStopDragCropArea","onStartCropResize","onCropResize","onStopCropResize","fragment","createDocumentFragment","imageObj","Image","setAttribute","className","onload","onerror","cloneNode","canvasWorkspace","tagName","cropAreaContainer","children","imageEditorWorkspace","imageEditorContainer","addEventListener","passive","dragging","appendChild","dragRequestId","resizing","cropActionTriggered","frameRateInterval","requestAnimationFrameId","lastTimestamp","transformMatrices","transformMatrix","inverseTransformMatrix","performance","now","setTimeout","requestAnimationFrame","event","preventDefault","target","stopImmediatePropagation","style","transition","cropEvent","mousePos","x","y","newDx","newDy","scale","Object","assign","removeEventListener","drawImage","classList","contains","shiftKey","zoomOut","zoomOutImage","zoomInImage","scaleRatio","console","log","timestamp","elapsedTime","offsetWidth","offsetHeight","naturalWidth","naturalHeight","context","getContext","scaledCropWidth","Math","floor","scaledCropHeight","clearRect","save","sourceCoords","sourceX","sourceY","sourceWidth","sourceHeight","destX","destY","destWidth","destHeight","restore","noop","throttle","createElement","getOffsetRelativeToParent","getCenterPositionRelativeToParent","getMousePosition","calculateAspectRatioFit","calculateOriginalDimensionsFromScaled","transformCSS","getRadianFromDegrees","getDegreesFromRadians","regExp","hasClass","removeClass","createTransformMatrix","getOriginalCoordinatesFromTransformedMatrix","Function","prototype","type","name","obj","running","func","throttledRequestAnimationFrame","dispatchEvent","CustomEvent","options","element","attributes","attr","text","createTextNode","length","i","childrenLength","HTMLElement","childCssSelector","parentCssSelector","childElem","parentElem","Error","childRect","getBoundingClientRect","parentRect","childElement","parentElement","contextElement","offsetLeft","pageXOffset","offsetTop","pageYOffset","pageX","touches","pageY","srcWidth","srcHeight","maxWidth","maxHeight","gutter","aspectRatio","min","scaledWidth","scaledHeight","PI","RegExp","Element","test","replace","remove","rotate","cos","sin","cross","xx","yy"],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;;;;AC7DA;;;;;;AAEAA,OAAOC,WAAP,GAAqB,0BACjB;AACIC,eAAW,iEADf;AAEIC,kBAAc,sBAFlB;AAGIC;AAHJ,CADiB,EAMjBC,SAASC,aAAT,CAAwB,uCAAxB,CANiB,CAArB;;AAUA;AACA,SAASF,kBAAT,CAA6BG,mBAA7B,EAAmD;;AAE/C,QAAMC,kBAAkBH,SAASC,aAAT,CAAwB,kDAAxB,CAAxB;AACA,QAAMG,mBAAmBJ,SAASC,aAAT,CAAwB,gDAAxB,CAAzB;AACA,QAAMI,eAAeH,oBAAoBI,MAApB,CAA2BC,SAA3B,CAAqC,YAArC,EAAmD,GAAnD,CAArB;AACAJ,oBAAgBK,GAAhB,GAAsBH,YAAtB;AACAF,oBAAgBM,KAAhB,GAAwBP,oBAAoBQ,OAApB,CAA4BD,KAApD;AACAN,oBAAgBQ,MAAhB,GAAyBT,oBAAoBQ,OAApB,CAA4BC,MAArD;AACAP,qBAAiBQ,IAAjB,GAAwBP,YAAxB;;AAEA,QAAMQ,sHAIQX,oBAAoBY,QAApB,CAA6BL,KAJrC,4BAKUP,oBAAoBY,QAApB,CAA6BH,MALvC,2IAWQT,oBAAoBQ,OAApB,CAA4BD,KAXpC,WAW+CP,oBAAoBQ,OAApB,CAA4BC,MAX3E,qJAe6BT,oBAAoBQ,OAApB,CAA4BK,OAfzD,6FAAN;;AAmBAf,aAASC,aAAT,CAAwB,qCAAxB,EAAgEe,SAAhE,GAA4EH,QAA5E;AAEH,C;;;;;;;;;;;;;;;;;AC5CD;;;;AAYA,IAAMI,YAAY,cAAlB;AACA,IAAMC,iBAAiB,oBAAvB;AACA,IAAMC,gBAAgB,CAAtB;AACA,IAAMC,QAAQ,IAAd;;AAEA;AACA;;;AAIA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;AAqBA;;;;;;;;;;;;;IAcqBC,W;AAEjB,yBAAaC,KAAb,EAAoBC,SAApB,EAAgC;AAAA;;AAE5B;AACA,aAAKC,KAAL,GAAa;AACTC,uBAAW;AACPC,uBAAO,CADA;AAEPC,4BAAY,CAFL;AAGPC,4BAAY,CAHL;AAIPC,yBAAS,CAJF;AAKPC,yBAAS,iCAAsB,CAAtB,CALF;AAMPC,wBAAQ,CAAE,QAAF,EAAY,QAAZ;AAND,aADF;AAST;AACA;AACAC,sBAAU;AACNC,sBAAM,CADA;AAENC,qBAAK;AAFC,aAXD;AAeTnB,qBAAS,KAfA;AAgBTN,mBAAO,CAhBE;AAiBTE,oBAAQ,CAjBC;AAkBTwB,kBAAM;AACJC,wBAAO,CADH;AAEJC,wBAAO,CAFH;AAGJC,oBAAI,CAHA;AAIJC,oBAAI;AAJA,aAlBG;AAwBTC,sBAAU;AAxBD,SAAb;;AA2BA;AACA,aAAKC,YAAL,GAAoB;AAChB;AACA;AACA;AACAC,2BAAe;AACXjC,uBAAO,CADI;AAEXE,wBAAQ;AAFG,aAJC;AAQhB;AACA;AACA;AACAgC,2BAAe;AACXlC,uBAAO,EADI;AAEXE,wBAAQ;AAFG,aAXC;AAehB;AACAqB,sBAAU;AACNE,qBAAK,CADC;AAENU,uBAAO,CAFD;AAGNC,wBAAQ,CAHF;AAINZ,sBAAM;AAJA,aAhBM;AAsBhB;AACAxB,mBAAO,CAvBS;AAwBhBE,oBAAQ,CAxBQ;AAyBhBmC,qBAAS;AAzBO,SAApB;;AA4BA,aAAKC,SAAL,GAAiB,KAAjB;;AAEA;AACA,aAAKC,cAAL,GAAsB;AAClBvC,mBAAO,CADW;AAElBE,oBAAQ;AAFU,SAAtB;;AAKA;AACA,aAAKd,SAAL,GAAiByB,MAAMzB,SAAvB;;AAEA;AACA,aAAKoD,aAAL,GAAqB,IAArB;;AAEA;AACA,aAAK1B,SAAL,GAAiBA,SAAjB;;AAEA;AACA,aAAK2B,aAAL,GAAqB,KAAKA,aAAL,CAAmBC,IAAnB,CAAyB,IAAzB,CAArB;AACA,aAAKC,eAAL,GAAuB,KAAKA,eAAL,CAAqBD,IAArB,CAA2B,IAA3B,CAAvB;AACA,aAAKE,cAAL,GAAsB,KAAKA,cAAL,CAAoBF,IAApB,CAA0B,IAA1B,CAAtB;AACA,aAAKC,eAAL,GAAuB,KAAKA,eAAL,CAAqBD,IAArB,CAA2B,IAA3B,CAAvB;AACA,aAAKG,mBAAL,GAA2B,KAAKA,mBAAL,CAAyBH,IAAzB,CAA+B,IAA/B,CAA3B;AACA,aAAKI,cAAL,GAAsB,KAAKA,cAAL,CAAoBJ,IAApB,CAA0B,IAA1B,CAAtB;AACA,aAAKK,kBAAL,GAA0B,KAAKA,kBAAL,CAAwBL,IAAxB,CAA8B,IAA9B,CAA1B;AACA,aAAKM,iBAAL,GAAyB,KAAKA,iBAAL,CAAuBN,IAAvB,CAA6B,IAA7B,CAAzB;AACA,aAAKO,YAAL,GAAoB,KAAKA,YAAL,CAAkBP,IAAlB,CAAwB,IAAxB,CAApB;AACA,aAAKQ,gBAAL,GAAwB,KAAKA,gBAAL,CAAsBR,IAAtB,CAA4B,IAA5B,CAAxB;;AAGA;AACA,YAAMS,WAAW5D,SAAS6D,sBAAT,EAAjB;;AAEA;AACA,aAAKC,QAAL,GAAgB,IAAIC,KAAJ,EAAhB;AACA,aAAKD,QAAL,CAAcE,YAAd,CAA2B,aAA3B,EAA0C,WAA1C;AACA,aAAKF,QAAL,CAAcG,SAAd,GAA6BhD,SAA7B;AACA,aAAK6C,QAAL,CAAcE,YAAd,CAA4B,KAA5B,EAAmC,KAAKlE,YAAL,IAAqBoB,cAAxD;AACA,aAAK4C,QAAL,CAAcI,MAAd,GAAuB,KAAKhB,aAA5B;AACA,aAAKY,QAAL,CAAcK,OAAd;;AAEA;AACA,aAAKlB,aAAL,GAAqB,KAAKa,QAAL,CAAcM,SAAd,CAAwB,IAAxB,CAArB;;AAEA;AACA;AACA;AACA;AACA,aAAKC,eAAL,GAAuB,0BAAe;AAClCC,qBAAS,QADyB;AAElCL,uBAAchD,SAAd;AAFkC,SAAf,CAAvB;;AAKA;AACA;AACA,aAAKsD,iBAAL,GAAyB,0BAAe;AACpCD,qBAAS,KAD2B;AAEpCL,uBAAchD,SAAd,qBAFoC;AAGpC,0BAAc,eAHsB;AAIpCuD,sBAAW,CACP;AACIF,yBAAS,KADb;AAEIL,+DAA6ChD,SAA7C;AAFJ,aADO,EAKP;AACIqD,yBAAS,KADb;AAEIL,+DAA6ChD,SAA7C;AAFJ,aALO,EASP;AACIqD,yBAAS,KADb;AAEIL,+DAA6ChD,SAA7C;AAFJ,aATO,EAaP;AACIqD,yBAAS,KADb;AAEIL,+DAA6ChD,SAA7C;AAFJ,aAbO,EAiBP;AACIqD,yBAAS,MADb;AAEIL,oDAAkChD,SAAlC;AAFJ,aAjBO,EAqBP;AACIqD,yBAAS,MADb;AAEIL,oDAAkChD,SAAlC;AAFJ,aArBO,EAyBP,KAAKoD,eAzBE;;AAJyB,SAAf,CAAzB;;AAiCA;AACA,aAAKI,oBAAL,GAA4B,0BAAe;AACvCH,qBAAS,KAD8B;AAEvCL,uBAAchD,SAAd,gBAFuC;AAGvCuD,sBAAW,CAAE,KAAKD,iBAAP,EAA0B,KAAKT,QAA/B;AAH4B,SAAf,CAA5B;;AAMA;AACA,aAAKY,oBAAL,GAA4B,0BAAe;AACvCJ,qBAAS,KAD8B;AAEvCL,uBAAchD,SAAd,oBAAsCA,SAAtC,wBAFuC;AAGvCuD,sBAAW,CAAE,KAAKC,oBAAP;AAH4B,SAAf,CAA5B;;AAOA;AACA;AACA,aAAKF,iBAAL,CAAuBI,gBAAvB,CAAyC,WAAzC,EAAsD,KAAKrB,mBAA3D;AACA,aAAKiB,iBAAL,CAAuBI,gBAAvB,CAAyC,YAAzC,EAAuD,KAAKrB,mBAA5D,EAAiF,EAAEsB,SAAS,IAAX,EAAjF;;AAEA;AACA,aAAKC,QAAL,GAAgB,KAAhB;;AAGA;AACAjB,iBAASkB,WAAT,CAAsB,KAAKJ,oBAA3B;AACA,aAAKnD,SAAL,CAAeuD,WAAf,CAA4BlB,QAA5B;;AAEA;AACA,aAAKmB,aAAL,GAAqB,IAArB;;AAEA;AACA;AACA;AACA,aAAKC,QAAL,GAAgB,KAAhB;AACA,aAAKC,mBAAL;;AAEA,aAAKC,iBAAL,GAAyB,OAAO,EAAhC;AACA,aAAKC,uBAAL,GAA+B,IAA/B;AACA,aAAKC,aAAL,GAAqB,IAArB;;AAEA;AACA,aAAKrF,kBAAL,GAA0BuB,MAAMvB,kBAAhC;;AAEA;AACA,aAAKsF,iBAAL,GAA0B;AACtBC,6BAAiB,CAAE,CAAF,EAAK,CAAL,EAAQ,CAAR,EAAW,CAAX,EAAc,CAAd,EAAiB,CAAjB,CADK;AAEtBC,oCAAwB,CAAE,CAAF,EAAK,CAAL,EAAQ,CAAR,EAAW,CAAX;AAFF,SAA1B;AAIA;AACA,aAAKzB,QAAL,CAActD,GAAd,GAAoB,KAAKX,SAAzB;;AAEA,eAAO,IAAP;AAEH;;;;wCAEe;AAAA;;AAEZ;AACA,iBAAKuD,eAAL;;AAEA,gBAAK,OAAOzD,MAAP,KAAkB,WAAvB,EAAqC;AAC/B,qBAAKyF,aAAL,GAAqBzF,OAAO6F,WAAP,CAAmBC,GAAnB,EAArB;AACA9F,uBAAOgF,gBAAP,CAAyB,QAAzB,EAAmC,KAAKtB,cAAxC;AACL;;AAED;AACA;AACAqC,uBAAY,YAAM;AACd,wCAAa,MAAKhB,oBAAlB,EAA2CzD,SAA3C;AACH,aAFD;AAGH;;;yCAEgB;AACb,iBAAKkE,uBAAL,GAA+BxF,OAAOgG,qBAAP,CAA8B,KAAKvC,eAAnC,CAA/B;AACH;;AAED;;;;;;;;4CAOqBwC,K,EAAQ;;AAEzBA,kBAAMC,cAAN;;AAEA;AACA;AACA,gBAAM,qBAAUD,MAAME,MAAhB,EAA2B7E,SAA3B,wBAAN,EAAmE;AAC/D2E,sBAAMG,wBAAN;AACA;;AAEA;AACA,qBAAKtD,YAAL,CAAkBK,OAAlB,GAA4B,IAA5B;AACA,qBAAKyB,iBAAL,CAAuByB,KAAvB,CAA6BC,UAA7B,GAA0C,OAA1C;;AAEA;AACA,qBAAKC,SAAL,GAAiBN,KAAjB;;AAEA,qBAAKnC,iBAAL,CAAwBmC,KAAxB;AACA,uBAAO,KAAP;AACH;;AAED;AACA,iBAAKlB,oBAAL,CAA0BC,gBAA1B,CAA4C,SAA5C,EAAuD,KAAKnB,kBAA5D;AACA,iBAAKkB,oBAAL,CAA0BC,gBAA1B,CAA4C,UAA5C,EAAwD,KAAKnB,kBAA7D;AACA,iBAAKkB,oBAAL,CAA0BC,gBAA1B,CAA4C,YAA5C,EAA0D,KAAKnB,kBAA/D;;AAEA,gBAAM2C,WAAW,6BAAkBP,KAAlB,EAAyB,KAAKlB,oBAA9B,CAAjB;;AAEA;AACA;AACA,iBAAKlD,KAAL,CAAWW,IAAX,CAAgBC,MAAhB,GAAyB+D,SAASC,CAAT,GAAa,KAAK5E,KAAL,CAAWC,SAAX,CAAqBE,UAA3D;AACA,iBAAKH,KAAL,CAAWW,IAAX,CAAgBE,MAAhB,GAAyB8D,SAASE,CAAT,GAAa,KAAK7E,KAAL,CAAWC,SAAX,CAAqBG,UAA3D;;AAEA;AACA5B,qBAAS2E,gBAAT,CAA2B,WAA3B,EAAwC,KAAKpB,cAA7C;AACAvD,qBAAS2E,gBAAT,CAA2B,WAA3B,EAAwC,KAAKpB,cAA7C,EAA6D,EAAEqB,SAAS,IAAX,EAA7D;AACH;;;uCAGegB,K,EAAQ;;AAEpB,iBAAKf,QAAL,GAAgB,IAAhB;AACA,gBAAMsB,WAAW,6BAAkBP,KAAlB,EAAyB,KAAKlB,oBAA9B,CAAjB;;AAEA,gBAAI4B,QAAQH,SAASC,CAAT,GAAa,KAAK5E,KAAL,CAAWW,IAAX,CAAgBC,MAAzC;AACA,gBAAImE,QAAQJ,SAASE,CAAT,GAAa,KAAK7E,KAAL,CAAWW,IAAX,CAAgBE,MAAzC;;AAEA,gBAAK,KAAKb,KAAL,CAAWf,KAAX,GAAmB,KAAKgC,YAAL,CAAkBhC,KAArC,IACD,KAAKe,KAAL,CAAWb,MAAX,GAAoB,KAAK8B,YAAL,CAAkB9B,MADrC,IAEE2F,SAAS,KAAK7D,YAAL,CAAkBT,QAAlB,CAA2BC,IAFtC,IAGEsE,SAAS,KAAK9D,YAAL,CAAkBT,QAAlB,CAA2BE,GAHtC,IAIG,CAAC,CAAD,GAAKqE,KAAN,GAAe,KAAK9D,YAAL,CAAkB9B,MAAjC,IAA2C,KAAKa,KAAL,CAAWb,MAJxD,IAKE2F,SAAU,KAAK7D,YAAL,CAAkBhC,KAAlB,GAA0B,KAAKe,KAAL,CAAWf,KALtD,EAK8D;;AAG1D,qBAAK4E,iBAAL,gBACO,kCACC,KAAKA,iBAAL,CAAuBC,eADxB,EAEC,KAAKD,iBAAL,CAAuBE,sBAFxB,EAGCe,KAHD,EAICC,KAJD,EAKC,KAAK/E,KAAL,CAAWC,SAAX,CAAqB+E,KALtB,EAMC,KAAKhF,KAAL,CAAWC,SAAX,CAAqBK,OANtB,CADP;;AAWA,qBAAKgC,QAAL,CAAckC,KAAd,CAAoBvE,SAApB,qCACM,KAAK4D,iBAAL,CAAuBC,eAAvB,CAAuC,CAAvC,CADN,4BAEM,KAAKD,iBAAL,CAAuBC,eAAvB,CAAuC,CAAvC,CAFN,4BAGM,KAAKD,iBAAL,CAAuBC,eAAvB,CAAuC,CAAvC,CAHN,4BAIM,KAAKD,iBAAL,CAAuBC,eAAvB,CAAuC,CAAvC,CAJN,4BAKM,KAAKD,iBAAL,CAAuBC,eAAvB,CAAuC,CAAvC,CALN,4BAMM,KAAKD,iBAAL,CAAuBC,eAAvB,CAAuC,CAAvC,CANN;;AAQA;AACA;AACA,qBAAK9D,KAAL,CAAWW,IAAX,GAAkBsE,OAAOC,MAAP,CAAe,EAAf,EAAoB,KAAKlF,KAAL,CAAWW,IAA/B,EAAqC;AACnDG,wBAAIgE,KAD+C;AAEnD/D,wBAAIgE;AAF+C,iBAArC,CAAlB;AAIH;AACL;;;6CAEqB;AACb,iBAAK1B,QAAL,GAAgB,KAAhB;AACA7E,qBAAS2G,mBAAT,CAA8B,WAA9B,EAA2C,KAAKpD,cAAhD;AACAvD,qBAAS2G,mBAAT,CAA8B,WAA9B,EAA2C,KAAKpD,cAAhD,EAAgE,EAAEqB,SAAS,IAAX,EAAhE;;AAEA,iBAAKpD,KAAL,CAAWC,SAAX,GAAuBgF,OAAOC,MAAP,CAAe,EAAf,EAAmB,KAAKlF,KAAL,CAAWC,SAA9B,EAAyC;AAC5DE,4BAAY,KAAKH,KAAL,CAAWW,IAAX,CAAgBG,EADgC;AAE5DV,4BAAY,KAAKJ,KAAL,CAAWW,IAAX,CAAgBI;AAFgC,aAAzC,CAAvB;;AAKA,iBAAKqE,SAAL;AACH;;;0CAGehB,K,EAAQ;;AAEtB,iBAAKf,QAAL,GAAgB,IAAhB;;AAEAe,kBAAMC,cAAN;;AAEA7F,qBAAS2E,gBAAT,CAA2B,WAA3B,EAAwC,KAAKjB,YAA7C;AACA1D,qBAAS2E,gBAAT,CAA2B,UAA3B,EAAuC,KAAKhB,gBAA5C;AACA3D,qBAAS2E,gBAAT,CAA2B,WAA3B,EAAwC,KAAKjB,YAA7C;AACA1D,qBAAS2E,gBAAT,CAA2B,SAA3B,EAAsC,KAAKhB,gBAA3C;;AAEA,iBAAKwC,QAAL,GAAgB;AACZC,mBAAG,CADS;AAEZC,mBAAG;AAFS,aAAhB;AAIL;;;qCAEcT,K,EAAQ;;AAEnB,iBAAKO,QAAL,GAAgB,6BAAkBP,KAAlB,EAAyB,KAAKlB,oBAA9B,CAAhB;AACA;AACA;AACA,gBAAIjE,cAAJ;AAAA,gBAAWE,eAAX;AAAA,gBAAmBsB,aAAnB;AAAA,gBAAyBC,YAAzB;AAAA,gBAA8BU,cAA9B;AAAA,gBAAqCC,eAArC;;AAEA,gBAAK,KAAKqD,SAAL,CAAeJ,MAAf,CAAsBe,SAAtB,CAAgCC,QAAhC,CAA6C7F,SAA7C,2BAAL,EAAuF;AACjFR,wBAAS,KAAK0F,QAAL,CAAcC,CAAd,GAAkB,KAAK3D,YAAL,CAAkBT,QAAlB,CAA2BC,IAAtD;AACAtB,yBAAS,KAAKwF,QAAL,CAAcE,CAAd,GAAkB,KAAK5D,YAAL,CAAkBT,QAAlB,CAA2BE,GAAtD;AACAD,uBAAO,KAAKQ,YAAL,CAAkBT,QAAlB,CAA2BC,IAAlC;AACAC,sBAAM,KAAKO,YAAL,CAAkBT,QAAlB,CAA2BE,GAAjC;;AAEA;AACA,qBAAKV,KAAL,CAAWC,SAAX,CAAqBM,MAArB,GAA8B,CAAE,MAAF,EAAU,KAAV,CAA9B;AACL;;AAED,gBAAK,KAAKmE,SAAL,CAAeJ,MAAf,CAAsBe,SAAtB,CAAgCC,QAAhC,CAA6C7F,SAA7C,2BAAL,EAAuF;;AAEjFR,wBAAS,KAAKgC,YAAL,CAAkBhC,KAAlB,IAA4B,KAAK0F,QAAL,CAAcC,CAAd,GAAkB,KAAK3D,YAAL,CAAkBT,QAAlB,CAA2BC,IAAzE,CAAT;AACAtB,yBAAS,KAAKwF,QAAL,CAAcE,CAAd,GAAkB,KAAK5D,YAAL,CAAkBT,QAAlB,CAA2BE,GAAtD;AACAD,uBAAO,KAAKkE,QAAL,CAAcC,CAArB;AACAlE,sBAAM,KAAKO,YAAL,CAAkBT,QAAlB,CAA2BE,GAAjC;;AAEA;AACA,qBAAKV,KAAL,CAAWC,SAAX,CAAqBM,MAArB,GAA8B,CAAE,OAAF,EAAW,KAAX,CAA9B;AAEL;;AAED,gBAAK,KAAKmE,SAAL,CAAeJ,MAAf,CAAsBe,SAAtB,CAAgCC,QAAhC,CAA6C7F,SAA7C,2BAAL,EAAuF;;AAEjFR,wBAAQ,KAAKgC,YAAL,CAAkBhC,KAAlB,IAA4B,KAAK0F,QAAL,CAAcC,CAAd,GAAkB,KAAK3D,YAAL,CAAkBT,QAAlB,CAA2BC,IAAzE,CAAR;AACAtB,yBAAS,KAAK8B,YAAL,CAAkB9B,MAAlB,IAA6B,KAAKwF,QAAL,CAAcE,CAAd,GAAkB,KAAK5D,YAAL,CAAkBT,QAAlB,CAA2BE,GAA1E,CAAT;AACAD,uBAAO,KAAKkE,QAAL,CAAcC,CAArB;AACAlE,sBAAM,KAAKiE,QAAL,CAAcE,CAApB;AACA,oBAAK,KAAKtD,SAAL,IAAkB6C,MAAMmB,QAA7B,EAAwC;AACpC7E,0BAAM,KAAKiE,QAAL,CAAcE,CAAd,IAAsB5F,QAAQ,KAAKe,KAAL,CAAWf,KAAnB,GAA2B,KAAKe,KAAL,CAAWb,MAAxC,GAAmDA,MAAvE,CAAN;AACH;;AAED;AACA,qBAAKa,KAAL,CAAWC,SAAX,CAAqBM,MAArB,GAA8B,CAAE,OAAF,EAAW,QAAX,CAA9B;AAEL;;AAED,gBAAK,KAAKmE,SAAL,CAAeJ,MAAf,CAAsBe,SAAtB,CAAgCC,QAAhC,CAA6C7F,SAA7C,2BAAL,EAAuF;;AAEjFR,wBAAU,KAAK0F,QAAL,CAAcC,CAAd,GAAkB,KAAK3D,YAAL,CAAkBT,QAAlB,CAA2BC,IAAvD;AACAtB,yBAAS,KAAK8B,YAAL,CAAkB9B,MAAlB,IAA6B,KAAKwF,QAAL,CAAcE,CAAd,GAAkB,KAAK5D,YAAL,CAAkBT,QAAlB,CAA2BE,GAA1E,CAAT;AACAD,uBAAO,KAAKQ,YAAL,CAAkBT,QAAlB,CAA2BC,IAAlC;AACAC,sBAAM,KAAKiE,QAAL,CAAcE,CAApB;AACA,oBAAK,KAAKtD,SAAL,IAAkB6C,MAAMmB,QAA7B,EAAwC;AACpC7E,0BAAM,KAAKiE,QAAL,CAAcE,CAAd,IAAqB5F,QAAQ,KAAKe,KAAL,CAAWf,KAAnB,GAA2B,KAAKe,KAAL,CAAWb,MAAvC,GAAkDA,MAAtE,CAAN;AACH;;AAED;AACA,qBAAKa,KAAL,CAAWC,SAAX,CAAqBM,MAArB,GAA8B,CAAE,MAAF,EAAU,QAAV,CAA9B;AAEL;;AAED,gBAAK,KAAKgB,SAAL,IAAkB6C,MAAMmB,QAA7B,EAAwC;AACpCpG,yBAASF,QAAQ,KAAKe,KAAL,CAAWf,KAAnB,GAA2B,KAAKe,KAAL,CAAWb,MAA/C;AACH;;AAED;AACA;AACA;AACA,gBAAKF,SAAS,KAAKgC,YAAL,CAAkBE,aAAlB,CAAgClC,KAAzC,IACEE,UAAU,KAAK8B,YAAL,CAAkBE,aAAlB,CAAgChC,MAD5C,IAEEF,QAAQ,KAAKgC,YAAL,CAAkBC,aAAlB,CAAgCjC,KAF1C,IAGEE,SAAS,KAAK8B,YAAL,CAAkBC,aAAlB,CAAgC/B,MAHhD,EAGyD;;AAErD;AACA,qBAAKqG,OAAL,GAAe,KAAf;AACA,qBAAK/B,mBAAL,GAA2B,IAA3B;;AAEA,oBAAKxE,QAAQ,KAAKgC,YAAL,CAAkBhC,KAA1B,IAAmCE,SAAS,KAAK8B,YAAL,CAAkB9B,MAAnE,EAA6E;AAC7E,yBAAKqG,OAAL,GAAe,IAAf;AACC;;AAGD,qBAAKvE,YAAL,CAAkBhC,KAAlB,GAA0BA,KAA1B;AACA,qBAAKgC,YAAL,CAAkB9B,MAAlB,GAA2BA,MAA3B;AACCkC,yBAAS,KAAKrB,KAAL,CAAWb,MAAX,GAAoBuB,GAApB,GAA0B,KAAKO,YAAL,CAAkB9B,MAArD;AACIiC,wBAAQ,KAAKpB,KAAL,CAAWf,KAAX,GAAmBwB,IAAnB,GAA0B,KAAKQ,YAAL,CAAkBhC,KAApD;;AAEL,qBAAKgC,YAAL,CAAkBT,QAAlB,GAA6B;AACzBE,yBAAKA,OAAO,CAAP,GAAWA,GAAX,GAAiB,CADG;AAEzBU,2BAAOA,SAAS,CAAT,GAAaA,KAAb,GAAqB,CAFH;AAGzBC,4BAAQA,UAAU,CAAV,GAAcA,MAAd,GAAuB,CAHN;AAIzBZ,0BAAMA,QAAQ,CAAR,GAAYA,IAAZ,GAAmB;AAJA,iBAA7B;AAMA,qBAAKsC,iBAAL,CAAuByB,KAAvB,CAA6BvF,KAA7B,GAA0C,KAAKgC,YAAL,CAAkBhC,KAA5D;AACA,qBAAK8D,iBAAL,CAAuByB,KAAvB,CAA6BrF,MAA7B,GAA0C,KAAK8B,YAAL,CAAkB9B,MAA5D;AACA,qBAAK4D,iBAAL,CAAuByB,KAAvB,CAA6B/D,IAA7B,GAAwC,KAAKQ,YAAL,CAAkBT,QAAlB,CAA2BC,IAAnE;AACA,qBAAKsC,iBAAL,CAAuByB,KAAvB,CAA6B9D,GAA7B,GAAuC,KAAKO,YAAL,CAAkBT,QAAlB,CAA2BE,GAAlE;;AAEC,oBAAI,KAAK8E,OAAT,EAAoB;AACjB,yBAAKC,YAAL;AACF;AACL;AAIJ;;;2CAEmB;;AAEhB,iBAAKpC,QAAL,GAAgB,KAAhB;AACA,iBAAKsB,QAAL,GAAgB,IAAhB;AACA,iBAAKD,SAAL,GAAiB,IAAjB;AACAlG,qBAAS2G,mBAAT,CAA8B,WAA9B,EAA2C,KAAKjD,YAAhD;AACA1D,qBAAS2G,mBAAT,CAA8B,SAA9B,EAAyC,KAAKhD,gBAA9C;;AAEA3D,qBAAS2G,mBAAT,CAA8B,WAA9B,EAA2C,KAAKjD,YAAhD;AACA1D,qBAAS2G,mBAAT,CAA8B,UAA9B,EAA0C,KAAKhD,gBAA/C;AACA,iBAAKY,iBAAL,CAAuByB,KAAvB,CAA6BC,UAA7B,GAA0C,kBAA1C;;AAEA,gBAAI,CAAC,KAAKhB,mBAAV,EAA+B;AAC7B;AACD;;AAED,iBAAKA,mBAAL,GAA2B,KAA3B;;AAEA;AACA;AACA,gBAAI,KAAK+B,OAAT,EAAkB;AACd,qBAAKA,OAAL,GAAe,KAAf;AACA,qBAAKvE,YAAL,CAAkB+D,KAAlB,GAA0B;AACtB/F,2BAAO,KAAKgC,YAAL,CAAkBhC,KAAlB,GAA0B,KAAKe,KAAL,CAAWf,KADtB;AAEtBE,4BAAQ,KAAK8B,YAAL,CAAkB9B,MAAlB,GAA2B,KAAKa,KAAL,CAAWb,MAFxB;AAGtBuB,yBAAK,KAAKO,YAAL,CAAkBT,QAAlB,CAA2BE,GAA3B,GAAiC,KAAKV,KAAL,CAAWb,MAH3B;AAItBsB,0BAAM,KAAKQ,YAAL,CAAkBT,QAAlB,CAA2BC,IAA3B,GAAkC,KAAKT,KAAL,CAAWf;AAJ7B,iBAA1B;AAMH,aARD,MAQO;AACH,qBAAKyG,WAAL;AACH;;AAED,iBAAKN,SAAL;AACH;;;sCAEa;;AAET;AACD,gBAAMO,aAAa,oCACb,KAAK1E,YAAL,CAAkBhC,KADL,EAEb,KAAKgC,YAAL,CAAkB9B,MAFL,EAGb,KAAKqC,cAAL,CAAoBvC,KAHP,EAIb,KAAKuC,cAAL,CAAoBrC,MAJP,EAKb,KAAKa,KAAL,CAAWT,OALE,EAMbI,aANa,CAAnB;;AAUA,gBAAMqF,QAAQ,KAAKhF,KAAL,CAAWC,SAAX,CAAqB+E,KAArB,GAA6BW,WAAWzF,KAAtD;;AAEA,gBAAI8E,SAAS,KAAKhF,KAAL,CAAWgB,QAAxB,EAAkC;AAC9B;AACH;AACD,gBAAMZ,aAAe,CAAC,CAAD,IAAM,KAAKa,YAAL,CAAkBT,QAAlB,CAA2BE,GAA3B,GAAiCiF,WAAWzF,KAAlD,CAAD,GACX,KAAKF,KAAL,CAAWC,SAAX,CAAqBG,UAArB,GAAkCuF,WAAWzF,KADtD;AAEA,gBAAMC,aAAe,CAAC,CAAD,IAAM,KAAKc,YAAL,CAAkBT,QAAlB,CAA2BC,IAA3B,GAAkCkF,WAAWzF,KAAnD,CAAD,GACX,KAAKF,KAAL,CAAWC,SAAX,CAAqBE,UAArB,GAAkCwF,WAAWzF,KADtD;;AAGA,iBAAK2D,iBAAL,gBACO,kCACC,KAAKA,iBAAL,CAAuBC,eADxB,EAEC,KAAKD,iBAAL,CAAuBE,sBAFxB;AAGC;AACA5D,sBAJD,EAKCC,UALD,EAMC4E,KAND,EAOC,KAAKhF,KAAL,CAAWC,SAAX,CAAqBK,OAPtB,CADP;;AAYA,iBAAKgC,QAAL,CAAckC,KAAd,CAAoBvE,SAApB,iCACM,KAAK4D,iBAAL,CAAuBC,eAAvB,CAAuC,CAAvC,CADN,wBAEM,KAAKD,iBAAL,CAAuBC,eAAvB,CAAuC,CAAvC,CAFN,wBAGM,KAAKD,iBAAL,CAAuBC,eAAvB,CAAuC,CAAvC,CAHN,wBAIM,KAAKD,iBAAL,CAAuBC,eAAvB,CAAuC,CAAvC,CAJN,wBAKM,KAAKD,iBAAL,CAAuBC,eAAvB,CAAuC,CAAvC,CALN,wBAMM,KAAKD,iBAAL,CAAuBC,eAAvB,CAAuC,CAAvC,CANN;;AAQA,iBAAK9D,KAAL,CAAWf,KAAX,GAAmB,KAAKe,KAAL,CAAWf,KAAX,GAAmB0G,WAAWzF,KAAjD;AACA,iBAAKF,KAAL,CAAWb,MAAX,GAAoB,KAAKa,KAAL,CAAWb,MAAX,GAAoBwG,WAAWzF,KAAnD;;AAEA,iBAAKe,YAAL,CAAkBC,aAAlB,GAAkC;AAC9BjC,uBAAO,KAAKe,KAAL,CAAWf,KAAX,IAAoB,KAAKuC,cAAL,CAAoBvC,KAAxC,GAAgD,KAAKuC,cAAL,CAAoBvC,KAApE,GAA4E,KAAKe,KAAL,CAAWf,KADhE;AAE9BE,wBAAQ,KAAKa,KAAL,CAAWb,MAAX,IAAqB,KAAKqC,cAAL,CAAoBrC,MAAzC,GAAkD,KAAKqC,cAAL,CAAoBrC,MAAtE,GAA+E,KAAKa,KAAL,CAAWb;AAFpE,aAAlC;;AAKA,iBAAK8B,YAAL,CAAkBhC,KAAlB,GAA0B0G,WAAW1G,KAAX,IAAoB,KAAKgC,YAAL,CAAkBC,aAAlB,CAAgCjC,KAApD,GAA4D,KAAKgC,YAAL,CAAkBC,aAAlB,CAAgCjC,KAA5F,GAAoG0G,WAAW1G,KAAzI;AACA,iBAAKgC,YAAL,CAAkB9B,MAAlB,GAA2BwG,WAAWxG,MAAX,IAAqB,KAAK8B,YAAL,CAAkBC,aAAlB,CAAgC/B,MAArD,GAA8D,KAAK8B,YAAL,CAAkBC,aAAlB,CAAgC/B,MAA9F,GAAuGwG,WAAWxG,MAA7I;;AAEA,iBAAK8B,YAAL,CAAkBT,QAAlB,CAA2BE,GAA3B,GAAiC,CAAjC;AACA,iBAAKO,YAAL,CAAkBT,QAAlB,CAA2BC,IAA3B,GAAmC,CAAnC;;AAEA,iBAAKsC,iBAAL,CAAuByB,KAAvB,CAA6B/D,IAA7B,GAAwC,KAAKQ,YAAL,CAAkBT,QAAlB,CAA2BC,IAAnE;AACA,iBAAKsC,iBAAL,CAAuByB,KAAvB,CAA6B9D,GAA7B,GAAuC,KAAKO,YAAL,CAAkBT,QAAlB,CAA2BE,GAAlE;AACA,iBAAKqC,iBAAL,CAAuByB,KAAvB,CAA6BvF,KAA7B,GAA0C,KAAKgC,YAAL,CAAkBhC,KAA5D;AACA,iBAAK8D,iBAAL,CAAuByB,KAAvB,CAA6BrF,MAA7B,GAA2C,KAAK8B,YAAL,CAAkB9B,MAA7D;;AAEA,iBAAK8B,YAAL,CAAkB+D,KAAlB,GAA0B;AACtB/F,uBAAO,KAAKgC,YAAL,CAAkBhC,KAAlB,GAA0B,KAAKe,KAAL,CAAWf,KADtB;AAEtBE,wBAAQ,KAAK8B,YAAL,CAAkB9B,MAAlB,GAA2B,KAAKa,KAAL,CAAWb,MAFxB;AAGtBuB,qBAAK,KAAKO,YAAL,CAAkBT,QAAlB,CAA2BE,GAA3B,GAAiC,KAAKV,KAAL,CAAWb,MAH3B;AAItBsB,sBAAM,KAAKQ,YAAL,CAAkBT,QAAlB,CAA2BC,IAA3B,GAAkC,KAAKT,KAAL,CAAWf;AAJ7B,aAA1B;;AAQA,iBAAKe,KAAL,CAAWC,SAAX,GAAuBgF,OAAOC,MAAP,CAAe,EAAf,EAAmB,KAAKlF,KAAL,CAAWC,SAA9B,EAAyC;AAC5DE,sCAD4D;AAE5DC,sCAF4D;AAG5D4E;AAH4D,aAAzC,CAAvB;;AAMA,iBAAKI,SAAL;AAEH;;AAGD;;;;uCACe;AACZQ,oBAAQC,GAAR,CAAY,aAAZ;AACF;;AAGD;AACA;;;;wCACiBC,S,EAAY;;AAE3B,gBAAM7B,MAAM6B,SAAZ;AAAA,gBACIC,cAAc9B,MAAM,KAAKL,aAD7B;;AAGE,gBAAKmC,cAAc,KAAKrC,iBAAxB,EAA4C;AAC1C;AACD;;AAED;AACA;AACA,iBAAKE,aAAL,GAAqBK,MAAQ8B,cAAc,KAAKrC,iBAAhD;;AAEA;AACA,iBAAKlC,cAAL,CAAoBvC,KAApB,GAA4B,KAAKiE,oBAAL,CAA0B8C,WAAtD;AACA,iBAAKxE,cAAL,CAAoBrC,MAApB,GAA6B,KAAK+D,oBAAL,CAA0B+C,YAAvD;;AAEA,gBAAIN,mBAAJ;;AAEA;AACA,gBAAK,CAAE,KAAK1E,YAAL,CAAkBK,OAAzB,EAAmC;AAC/B;AACAqE,6BAAa,oCACP,KAAKrD,QAAL,CAAc4D,YADP,EAEP,KAAK5D,QAAL,CAAc6D,aAFP,EAGP,KAAK3E,cAAL,CAAoBvC,KAHb,EAIP,KAAKuC,cAAL,CAAoBrC,MAJb,EAKP,KAAKa,KAAL,CAAWT,OALJ,EAMPI,aANO,CAAb;;AAQA;AACA,qBAAKK,KAAL,CAAWf,KAAX,GAAmB0G,WAAW1G,KAA9B;AACA,qBAAKe,KAAL,CAAWb,MAAX,GAAoBwG,WAAWxG,MAA/B;AACA,qBAAKa,KAAL,CAAWC,SAAX,CAAqB+E,KAArB,GAA6BW,WAAWzF,KAAxC;;AAEA;AACA,qBAAKe,YAAL,CAAkB9B,MAAlB,GAA2B,KAAKa,KAAL,CAAWb,MAAtC;AACA,qBAAK8B,YAAL,CAAkBhC,KAAlB,GAA0B,KAAKe,KAAL,CAAWf,KAArC;AACA,qBAAKgC,YAAL,CAAkBT,QAAlB,GAA6B;AACzBE,yBAAM,CADmB;AAEzBU,2BAAO,KAAKpB,KAAL,CAAWf,KAFO;AAGzBoC,4BAAQ,KAAKrB,KAAL,CAAWb,MAHM;AAIzBsB,0BAAM;AAJmB,iBAA7B;;AAOJ;AACC,aA1BD,MA0BO;AACHkF,6BAAa,oCACP,KAAK1E,YAAL,CAAkBhC,KADX,EAEP,KAAKgC,YAAL,CAAkB9B,MAFX,EAGP,KAAKqC,cAAL,CAAoBvC,KAHb,EAIP,KAAKuC,cAAL,CAAoBrC,MAJb,EAKP,KAAKa,KAAL,CAAWT,OALJ,EAMPI,aANO,CAAb;;AASA,qBAAKK,KAAL,CAAWf,KAAX,GAAmB,KAAKe,KAAL,CAAWf,KAAX,GAAmB0G,WAAWzF,KAAjD;AACA,qBAAKF,KAAL,CAAWb,MAAX,GAAoB,KAAKa,KAAL,CAAWb,MAAX,GAAoBwG,WAAWzF,KAAnD;AACA,qBAAKF,KAAL,CAAWC,SAAX,CAAqB+E,KAArB,GAA6B,KAAKhF,KAAL,CAAWC,SAAX,CAAqB+E,KAArB,GAA6BW,WAAWzF,KAArE;;AAEA,qBAAKe,YAAL,CAAkBhC,KAAlB,GAA0B,KAAKgC,YAAL,CAAkB+D,KAAlB,CAAwB/F,KAAxB,GAAgC,KAAKe,KAAL,CAAWf,KAArE;AACA,qBAAKgC,YAAL,CAAkB9B,MAAlB,GAA2B,KAAK8B,YAAL,CAAkB+D,KAAlB,CAAwB7F,MAAxB,GAAiC,KAAKa,KAAL,CAAWb,MAAvE;AACA,qBAAK8B,YAAL,CAAkBT,QAAlB,CAA2BE,GAA3B,GAAmC,KAAKO,YAAL,CAAkB+D,KAAlB,CAAwBtE,GAAxB,GAA8B,KAAKV,KAAL,CAAWb,MAA5E;AACA,qBAAK8B,YAAL,CAAkBT,QAAlB,CAA2BC,IAA3B,GAAqC,KAAKQ,YAAL,CAAkB+D,KAAlB,CAAwBvE,IAAxB,GAA+B,KAAKT,KAAL,CAAWf,KAA/E;AACH;;AAEH;AACA;AACA;AACA,iBAAKe,KAAL,CAAWC,SAAX,GAAuBgF,OAAOC,MAAP,CAAe,EAAf,EAAmB,KAAKlF,KAAL,CAAWC,SAA9B,EAAyC;AAC5DE,4BAAY,KAAKH,KAAL,CAAWC,SAAX,CAAqBE,UAArB,GAAkCwF,WAAWzF,KADG;AAE5DE,4BAAY,KAAKJ,KAAL,CAAWC,SAAX,CAAqBG,UAArB,GAAmCuF,WAAWzF;AAFE,aAAzC,CAAvB;;AAKA;AACA,iBAAK2D,iBAAL,gBACO,kCACC,KAAKA,iBAAL,CAAuBC,eADxB,EAEC,KAAKD,iBAAL,CAAuBE,sBAFxB,EAGC,KAAK/D,KAAL,CAAWC,SAAX,CAAqBE,UAHtB,EAIC,KAAKH,KAAL,CAAWC,SAAX,CAAqBG,UAJtB,EAKC,KAAKJ,KAAL,CAAWC,SAAX,CAAqB+E,KALtB,EAMC,KAAKhF,KAAL,CAAWC,SAAX,CAAqBK,OANtB,CADP;;AAWA;AACA,iBAAKgC,QAAL,CAAckC,KAAd,CAAoBvE,SAApB,+BACM,KAAK4D,iBAAL,CAAuBC,eAAvB,CAAuC,CAAvC,CADN,sBAEM,KAAKD,iBAAL,CAAuBC,eAAvB,CAAuC,CAAvC,CAFN,sBAGM,KAAKD,iBAAL,CAAuBC,eAAvB,CAAuC,CAAvC,CAHN,sBAIM,KAAKD,iBAAL,CAAuBC,eAAvB,CAAuC,CAAvC,CAJN,sBAKM,KAAKD,iBAAL,CAAuBC,eAAvB,CAAuC,CAAvC,CALN,sBAMM,KAAKD,iBAAL,CAAuBC,eAAvB,CAAuC,CAAvC,CANN;;AAQE;AACA,iBAAKf,iBAAL,CAAuByB,KAAvB,CAA6B/D,IAA7B,GAAwC,KAAKQ,YAAL,CAAkBT,QAAlB,CAA2BC,IAAnE;AACA,iBAAKsC,iBAAL,CAAuByB,KAAvB,CAA6B9D,GAA7B,GAAuC,KAAKO,YAAL,CAAkBT,QAAlB,CAA2BE,GAAlE;AACA,iBAAKqC,iBAAL,CAAuByB,KAAvB,CAA6BvF,KAA7B,GAA0C,KAAKgC,YAAL,CAAkBhC,KAA5D;AACA,iBAAK8D,iBAAL,CAAuByB,KAAvB,CAA6BrF,MAA7B,GAA2C,KAAK8B,YAAL,CAAkB9B,MAA7D;;AAEA;AACA,iBAAK8B,YAAL,CAAkBC,aAAlB,GAAkC;AAC9BjC,uBAAO,KAAKe,KAAL,CAAWf,KAAX,IAAoB,KAAKuC,cAAL,CAAoBvC,KAAxC,GAAgD,KAAKuC,cAAL,CAAoBvC,KAApE,GAA4E,KAAKe,KAAL,CAAWf,KADhE;AAE9BE,wBAAQ,KAAKa,KAAL,CAAWb,MAAX,IAAqB,KAAKqC,cAAL,CAAoBrC,MAAzC,GAAkD,KAAKqC,cAAL,CAAoBrC,MAAtE,GAA+E,KAAKa,KAAL,CAAWb;AAFpE,aAAlC;;AAKA;AACA;AACA,iBAAKiG,SAAL;AAEH;;AAGD;AACA;AACA;;;;oCACY;;AAER,gBAAMgB,UAAU,KAAKvD,eAAL,CAAqBwD,UAArB,CAAgC,IAAhC,CAAhB;AACA,gBAAM9G,UAAU,KAAKS,KAAL,CAAWT,OAA3B;;AAGA,gBAAM+G,kBAAkBC,KAAKC,KAAL,CAAc,KAAKvF,YAAL,CAAkBhC,KAAlB,GAA0B,KAAKe,KAAL,CAAWC,SAAX,CAAqB+E,KAA7D,CAAxB;AACA,gBAAMyB,mBAAmBF,KAAKC,KAAL,CAAc,KAAKvF,YAAL,CAAkB9B,MAAlB,GAA2B,KAAKa,KAAL,CAAWC,SAAX,CAAqB+E,KAA9D,CAAzB;;AAIA,iBAAKnC,eAAL,CAAqB5D,KAArB,GAA6BqH,eAA7B;AACA,iBAAKzD,eAAL,CAAqB1D,MAArB,GAA+BsH,gBAA/B;;AAEAL,oBAAQM,SAAR,CAAmB,CAAnB,EAAsB,CAAtB,EAAyBJ,kBAAkB,CAA3C,EAA8CA,kBAAkB,CAAhE;;AAEA;AACA,gBAAK/G,OAAL,EAAe;AACX;AACA;AACA;AACH;;AAGD6G,oBAAQO,IAAR;;AAGA;AACA;AACA,gBAAMC,eAAe,wDACjB,KAAK/C,iBAAL,CAAuBC,eADN,EAEjB,KAAKD,iBAAL,CAAuBE,sBAFN,EAGjB,KAAK9C,YAAL,CAAkBT,QAAlB,CAA2BC,IAHV,EAIjB,KAAKQ,YAAL,CAAkBT,QAAlB,CAA2BE,GAJV,CAArB;;AAOA;AACA,gBAAMmG,UAAUD,aAAahC,CAA7B;AAAA,gBACMkC,UAAUF,aAAa/B,CAD7B;AAAA,gBAEMkC,cAAcT,eAFpB;AAAA,gBAGMU,eAAeP,gBAHrB;;AAKA;AACA,gBAAMQ,QAAQ,CAAd;AAAA,gBACMC,QAAQ,CADd;;;AAGA;AACIC,wBAAYb,eAJhB;AAAA,gBAKIc,aAAaX,gBALjB;;AAQA;AACAL,oBAAQhB,SAAR,CACI,KAAK9C,QADT;AAEI;AACAuE,mBAHJ,EAGaC,OAHb;AAII;AACAC,uBALJ,EAKiBC,YALjB;AAMI;AACAC,iBAPJ,EAOWC,KAPX;AAQI;AACAC,qBATJ,EASeC,UATf;;AAWAhB,oBAAQiB,OAAR;;AAEA,gBAAKzH,KAAL,EAAa;;AAET,qBAAKrB,kBAAL,CAAyB;AACrBO,4BAAQ,KAAK+D,eADQ;AAErBvD,8BAAU;AACNL,+BAAO,KAAKqD,QAAL,CAAc4D,YADf;AAEN/G,gCAAQ,KAAKmD,QAAL,CAAc6D;AAFhB,qBAFW;AAMrBjH,6BAAS;AACLD,+BAAOqH,eADF;AAELnH,gCAAQsH,gBAFH;AAGLlH,iCAASA;AAHJ;AANY,iBAAzB;AAYH;AACJ;;;+BAEOc,O,EAAU;AACd;AACA,iBAAKL,KAAL,CAAWC,SAAX,CAAqBI,OAArB,GAA+BA,OAA/B;AACA,iBAAKL,KAAL,CAAWC,SAAX,CAAqBK,OAArB,GAA+B,iCAAsBD,OAAtB,CAA/B;AACA,iBAAKL,KAAL,CAAWT,OAAX,GAAqB,EAAM,KAAKS,KAAL,CAAWC,SAAX,CAAqBI,OAArB,GAA+B,GAAjC,KAA2C,CAA/C,CAArB;AACA,iBAAKuB,eAAL;AACH;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;kBAzxBiB/B,W;;;;;;;;;;;;QC5DLyH,I,GAAAA,I;QAcAC,Q,GAAAA,Q;QAqCAC,a,GAAAA,a;QA8CAC,yB,GAAAA,yB;QAqCAC,iC,GAAAA,iC;QAqBAC,gB,GAAAA,gB;QA6BAC,uB,GAAAA,uB;QAiBAC,qC,GAAAA,qC;QAYAC,Y,GAAAA,Y;QAMAC,oB,GAAAA,oB;QAKAC,qB,GAAAA,qB;QAIAC,M,GAAAA,M;QAIAC,Q,GAAAA,Q;QAOAC,W,GAAAA,W;QAOAC,qB,GAAAA,qB;QA8BAC,2C,GAAAA,2C;AAxRhB;;;;AAIO,SAASf,IAAT,GAAgB;AACnBpD,eAAYoE,SAASC,SAArB,EAAgC,KAAhC;AACH;;AAED;;;;;;;;;;AAUO,SAAShB,QAAT,CAAmBiB,IAAnB,EAAyBC,IAAzB,EAA8C;AAAA,QAAfC,GAAe,uEAATvK,MAAS;;AACjD,QAAIwK,UAAU,KAAd;AACA,QAAMC,OAAO,SAAPA,IAAO,GAAW;AACpB,YAAID,OAAJ,EAAa;AAAE;AAAS;AACxBA,kBAAU,IAAV;AACAxE,8BAAsB,SAAS0E,8BAAT,GAA0C;AAC5DH,gBAAII,aAAJ,CAAmB,IAAIC,WAAJ,CAAiBN,IAAjB,CAAnB;AACAE,sBAAU,KAAV;AACH,SAHD;AAIH,KAPD;AAQAD,QAAIvF,gBAAJ,CAAqBqF,IAArB,EAA2BI,IAA3B;AACH;;AAED;;;;;;;;;;;;;;;;;;;;;;;;AAwBO,SAASpB,aAAT,CAAwBwB,OAAxB,EAAkC;;AAErC,QAAMC,UAAUzK,SAASgJ,aAAT,CAAwBwB,QAAQlG,OAAhC,CAAhB;;AAEA,QAAKkG,QAAQvG,SAAb,EAAyB;AACrBwG,gBAAQxG,SAAR,GAAoBuG,QAAQvG,SAA5B;AACH;;AAED,QAAKuG,QAAQE,UAAb,EAA0B;AACtB,aAAM,IAAIC,IAAV,IAAkBH,QAAQE,UAA1B,EAAuC;AACnCD,oBAAQzG,YAAR,CAAsB2G,IAAtB,EAA4BH,QAAQE,UAAR,CAAmBC,IAAnB,CAA5B;AACH;AACJ;;AAED,QAAKH,QAAQI,IAAb,EAAoB;AAChBH,gBAAQ3F,WAAR,CAAqB9E,SAAS6K,cAAT,CAAyBL,QAAQI,IAAjC,CAArB;AACH;;AAED,QAAKJ,QAAQhG,QAAR,IAAoBgG,QAAQhG,QAAR,CAAiBsG,MAA1C,EAAmD;AAC/C,YAAIC,IAAI,CAAR;AACA,YAAIC,iBAAiBR,QAAQhG,QAAR,CAAiBsG,MAAtC;AACA,eAAOC,IAAIC,cAAX,EAA2BD,GAA3B,EAAiC;AAC7BN,oBAAQ3F,WAAR,CAAqB0F,QAAQhG,QAAR,CAAiBuG,CAAjB,aAA+BpL,OAAOsL,WAAtC,GAAoDT,QAAQhG,QAAR,CAAiBuG,CAAjB,CAApD,GAA0E/B,cAAewB,QAAQhG,QAAR,CAAiBuG,CAAjB,CAAf,CAA/F;AACH;AACJ;;AAED,WAAON,OAAP;AAEH;;AAED;;;;;;;;;;;;;;;;AAgBO,SAASxB,yBAAT,CAAoCiC,gBAApC,EAAsDC,iBAAtD,EAAyE;;AAE5E;AACA;AACA,QAAMC,YAAYpL,SAASC,aAAT,CAAwBiL,gBAAxB,CAAlB;AACA,QAAMG,aAAarL,SAASC,aAAT,CAAwBkL,iBAAxB,CAAnB;;AAEA,QAAK,CAAEC,SAAF,IAAe,CAAEC,UAAtB,EAAmC;AAC/B,cAAM,IAAIC,KAAJ,qDAA4DJ,gBAA5D,YAAmFC,iBAAnF,CAAN;AACH;;AAED,QAAMI,YAAYH,UAAUI,qBAAV,EAAlB;AACA,QAAMC,aAAaJ,WAAWG,qBAAX,EAAnB;;AAEA,WAAO;AACHtJ,aAAKqJ,UAAUrJ,GAAV,GAAgBuJ,WAAWvJ,GAD7B;AAEHU,eAAO2I,UAAU3I,KAAV,GAAkB6I,WAAW7I,KAFjC;AAGHC,gBAAQ0I,UAAU1I,MAAV,GAAmB4I,WAAW5I,MAHnC;AAIHZ,cAAMsJ,UAAUtJ,IAAV,GAAiBwJ,WAAWxJ;AAJ/B,KAAP;AAOH;;AAED;;;;;;;;;;;;;;AAcO,SAASiH,iCAAT,CAA4CwC,YAA5C,EAA0DC,aAA1D,EAA0E;AAC7E,WAAO;AACH1J,cAAQ0J,cAAcnE,WAAd,GAA4B,CAA5B,GAAgCkE,aAAalE,WAAb,GAA2B,CADhE;AAEHtF,aAAOyJ,cAAclE,YAAd,GAA6B,CAA7B,GAAiCiE,aAAajE,YAAb,GAA4B;AAFjE,KAAP;AAIH;;AAED;;;;;;;;;;;;;;AAcO,SAAS0B,gBAAT,CAA2BvD,KAA3B,EAA0D;AAAA,QAAxBgG,cAAwB,uEAAP,IAAO;;;AAE7D,QAAMC,aAAaD,iBAAiBA,eAAeC,UAAhC,GAA6ClM,OAAOmM,WAAvE;AACA,QAAMC,YAAYH,iBAAiBA,eAAeG,SAAhC,GAA4CpM,OAAOqM,WAArE;;AAEA,QAAM5F,IAAI,CAAER,MAAMqG,KAAN,IAAerG,MAAMsG,OAAN,CAAc,CAAd,EAAiBD,KAAlC,IAA4CJ,UAAtD;AACA,QAAMxF,IAAI,CAAET,MAAMuG,KAAN,IAAevG,MAAMsG,OAAN,CAAc,CAAd,EAAiBC,KAAlC,IAA4CJ,SAAtD;;AAEA,WAAO;AACH3F,YADG;AAEHC;AAFG,KAAP;AAIH;;AAGD;;;;;;;;;;;;;;AAcO,SAAS+C,uBAAT,CAAkCgD,QAAlC,EAA4CC,SAA5C,EAAuDC,QAAvD,EAAiEC,SAAjE,EAA0G;AAAA,QAA9BxL,OAA8B,uEAApB,KAAoB;AAAA,QAAbyL,MAAa,uEAAJ,CAAI;;;AAE7G,QAAMC,cAAc1L,UAAUgH,KAAK2E,GAAL,CAAUH,YAAYH,QAAtB,EAAgCE,WAAWD,SAA3C,CAAV,GAAmEtE,KAAK2E,GAAL,CAAUJ,WAAWF,QAArB,EAA+BG,YAAYF,SAA3C,CAAvF;AACA;AACA,QAAM3K,QAAQ+K,cAAcD,MAA5B;;AAEA;AACA,QAAM/L,QAAQsH,KAAKC,KAAL,CAAYoE,WAAW1K,KAAvB,CAAd;AACA,QAAMf,SAASoH,KAAKC,KAAL,CAAYqE,YAAY3K,KAAxB,CAAf;;AAEA,WAAO;AACHA,oBADG;AAEHjB,oBAFG;AAGHE;AAHG,KAAP;AAKH;;AAEM,SAAS0I,qCAAT,CAAgDsD,WAAhD,EAA6DC,YAA7D,EAA2ElL,KAA3E,EAAmF;;AAEtF;AACA,QAAMjB,QAAQsH,KAAKC,KAAL,CAAY2E,cAAcjL,KAA1B,CAAd;AACA,QAAMf,SAASoH,KAAKC,KAAL,CAAY4E,eAAelL,KAA3B,CAAf;;AAEA,WAAO;AACHjB,oBADG;AAEHE;AAFG,KAAP;AAIH;;AAEM,SAAS2I,YAAT,CAAuBmB,OAAvB,EAAyF;AAAA,QAAzD9I,UAAyD,uEAA5C,CAA4C;AAAA,QAAzCC,UAAyC,uEAA5B,CAA4B;AAAA,QAAzB4E,KAAyB,uEAAjB,CAAiB;AAAA,QAAd1E,OAAc,uEAAJ,CAAI;;AAC5F2I,YAAQzE,KAAR,CAAcvE,SAAd,mBAAyCE,UAAzC,YAA4DC,UAA5D,oBAAuF4E,KAAvF,mBAA4G1E,OAA5G;AACA,WAAO2I,OAAP;AACH;;AAED;AACO,SAASlB,oBAAT,CAA+B1H,OAA/B,EAAyC;AAC5C,WAAOA,UAAUkG,KAAK8E,EAAf,GAAoB,GAA3B;AACH;;AAED;AACO,SAASrD,qBAAT,CAAgC1H,OAAhC,EAA0C;AAC7C,WAAOA,UAAU,GAAV,GAAgBiG,KAAK8E,EAA5B;AACH;;AAEM,SAASpD,MAAT,CAAiBQ,IAAjB,EAAwB;AAC3B,WAAO,IAAI6C,MAAJ,WAAoB7C,IAApB,WAAP;AACH;;AAEM,SAASP,QAAT,CAAmBe,OAAnB,EAA4BxG,SAA5B,EAAwC;AAC3C,QAAK,EAAI,eAAe8I,QAAQhD,SAA3B,CAAL,EAA+C;AAC3C,eAAON,OAAQQ,IAAR,EAAe+C,IAAf,CAAqB,KAAKvC,OAAL,CAAaxG,SAAlC,CAAP;AACH;AACD,WAAOwG,QAAQ5D,SAAR,CAAkBC,QAAlB,CAA4B7C,SAA5B,CAAP;AACH;;AAEM,SAAS0F,WAAT,CAAsBc,OAAtB,EAA+BxG,SAA/B,EAA2C;AAC9C,QAAK,EAAI,eAAe8I,QAAQhD,SAA3B,CAAL,EAA8C;AAC1C,eAAOU,QAAQxG,SAAR,GAAqBwG,QAAQxG,SAAR,CAAkBgJ,OAAlB,CAA2BxD,OAAQQ,IAAR,CAA3B,EAA2C,EAA3C,CAA5B;AACH;AACD,WAAOQ,QAAQ5D,SAAR,CAAkBqG,MAAlB,CAA0BjJ,SAA1B,CAAP;AACH;;AAEM,SAAS2F,qBAAT,CAAgCtE,eAAhC,EAAiDC,sBAAjD,EAAyEa,CAAzE,EAA4EC,CAA5E,EAA+EG,KAA/E,EAAsF2G,MAAtF,EAA+F;;AAElG;AACA7H,oBAAgB,CAAhB,IAAuBA,gBAAgB,CAAhB,IAAqByC,KAAKqF,GAAL,CAASD,MAAT,IAAmB3G,KAA/D;AACAlB,oBAAgB,CAAhB,IAAqB,EAAEA,gBAAgB,CAAhB,IAAqByC,KAAKsF,GAAL,CAASF,MAAT,IAAmB3G,KAA1C,CAArB;;AAEA;AACAlB,oBAAgB,CAAhB,IAAqBc,CAArB;AACAd,oBAAgB,CAAhB,IAAqBe,CAArB;;AAEA;;AAEA;AACA,QAAIiH,QAAQhI,gBAAgB,CAAhB,IAAqBA,gBAAgB,CAAhB,CAArB,GAA0CA,gBAAgB,CAAhB,IAAqBA,gBAAgB,CAAhB,CAA3E;;AAEA;AACAC,2BAAuB,CAAvB,IAA6BD,gBAAgB,CAAhB,IAAqBgI,KAAlD;AACA/H,2BAAuB,CAAvB,IAA4B,CAACD,gBAAgB,CAAhB,CAAD,GAAsBgI,KAAlD;AACA/H,2BAAuB,CAAvB,IAA4B,CAACD,gBAAgB,CAAhB,CAAD,GAAsBgI,KAAlD;AACA/H,2BAAuB,CAAvB,IAA6BD,gBAAgB,CAAhB,IAAqBgI,KAAlD;;AAGA,WAAO;AACHhI,wCADG;AAEHC;AAFG,KAAP;AAIH;;AAED;AACA;AACO,SAASsE,2CAAT,CAAsDvE,eAAtD,EAAuEC,sBAAvE,EAA+Fa,CAA/F,EAAkGC,CAAlG,EAAsG;AACzG,QAAIkH,EAAJ,EAAQC,EAAR;AACAD,SAAKnH,IAAId,gBAAgB,CAAhB,CAAT,CAFyG,CAExE;AACjCkI,SAAKnH,IAAIf,gBAAgB,CAAhB,CAAT,CAHyG,CAGxE;AACjC;AACA,WAAO;AACHc,WAAKmH,KAAKhI,uBAAuB,CAAvB,CAAL,GAAiCiI,KAAKjI,uBAAuB,CAAvB,CADxC;AAEHc,WAAKkH,KAAKhI,uBAAuB,CAAvB,CAAL,GAAiCiI,KAAKjI,uBAAuB,CAAvB;AAFxC,KAAP;AAIH,C","file":"main.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 59714b1460a612149056","import ImageEditor from './image-editor';\n\nwindow.imageEditor = new ImageEditor(\n    {\n        imagePath: 'https://ramonjd.github.io/crop-dog/src/A-Village-After-Dark.jpg',\n        imageAltText: 'A village after dark',\n        onWorkSpaceUpdated\n    },\n    document.querySelector( '.media-image-editor__canvas-container' )\n);\n\n\n// DEBUG\nfunction onWorkSpaceUpdated( newImageEditorState ) {\n\n    const croppedImageObj = document.querySelector( '.media-image-editor_debug__preview-container img' );\n    const croppedImageAtag = document.querySelector( '.media-image-editor_debug__preview-container a' );\n    const previewImage = newImageEditorState.canvas.toDataURL('image/jpeg', 0.8);\n    croppedImageObj.src = previewImage;\n    croppedImageObj.width = newImageEditorState.cropped.width;\n    croppedImageObj.height = newImageEditorState.cropped.height;\n    croppedImageAtag.href = previewImage;\n\n    const template = `\n        <li>\n            <var>Original image dimensions</var>\n            <samp>\n                ${newImageEditorState.original.width}\n                x ${newImageEditorState.original.height}\n            </samp>\n        </li>\n        <li>\n            <var>Cropped dimensions</var>\n            <samp>\n                ${newImageEditorState.cropped.width} x ${newImageEditorState.cropped.height}\n            </samp>\n        </li>\n        <li><var>Cropped coordinates</var> <samp>TBD</samp></li>\n        <li><var>Rotated</var> <samp>${newImageEditorState.cropped.rotated}</samp></li>\n        <li><var>Ratio to original image</var> <samp>TBD</samp></li>\n    `;\n\n    document.querySelector( '.media-image-editor_debug-values ul' ).innerHTML = template;\n\n}\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","import {\n    noop,\n    createElement,\n    calculateAspectRatioFit,\n    getRadianFromDegrees,\n    hasClass,\n    removeClass,\n    getMousePosition ,\ngetOffsetRelativeToParent,\ncreateTransformMatrix,\ngetOriginalCoordinatesFromTransformedMatrix } from './utils';\n\nconst NAMESPACE = 'image-editor';\nconst IMAGE_ALT_TEXT = 'Image being edited';\nconst EDITOR_GUTTER = 1;\nconst DEBUG = true;\n\n// https://codepen.io/anon/pen/YQJmMr\n//https://stackoverflow.com/questions/34597160/html-canvas-mouse-position-after-scale-and-translate\n\n\n\n// animationframe\n// drawImage while resizing crop area\n// https://stackoverflow.com/questions/6198771/drawing-image-in-canvas-at-an-angle-without-rotating-the-canvas\n// https://stackoverflow.com/questions/41847928/scaling-the-image-and-fitting-in-the-canvas-after-rotation\n\n// when crop tool hits boundary and there's image overflow, zoom/scale image down\n// when cropping down, cropped area zooms out to max width and height according to aspect ratio of container\n/*\n * Cropping area\n * on page load dimensions of the cropping area = the scaled dims of the image\n *\n * 1.    the min dimensions of the cropping area:\n *\n *       a) when the scaled image dims are >= than the cropped area ? 50px square (or according to the aspect ratio)\n *       b) when the scaled image dims === cropped area ? image dims\n *\n * 2.    the max dimensions of the cropping area:\n *       a) when the image dims are > than the cropped area ? = the container bounds - gutter\n *\n *       b) when a crop handler reaches its max bound in any corner\n *       i) if scaled image dim are greater than the cropped area ? make transform-origin the dragged corner of the cropped Area and scale the image\n *      while the mouse is down according to mouse position * sensitivity (the more image overflow there is the faster the growth) until the\n *      cropped area dims reach the scaled height or width of the image\n *\n *      c) when scaled image dims === cropping area dims ?\n *\n * */\n\n/*\n\n// experimental zoom out calculations, might not work\n// which is distance between the dragged corner and the nearest corner of the scaled image\n// it should form some sort of rectangle so the distance is the hypotenuse  \nfunction getHypotenuse ( a, b ) {\n    return Math.sqrt( (a * a) + ( b * b ) );\n}\nfunction getZoomRatio ( newHypontenuse, oldHypontenuse ) {\n    return newHypontenuse / oldHypontenuse   ;\n}\n*/\n\n\nexport default class ImageEditor {\n\n    constructor( props, container ) {\n\n        // cache of computed image properties\n        this.image = {\n            transform: {\n                ratio: 0,\n                translateX: 0,\n                translateY: 0,\n                degrees: 0,\n                radians: getRadianFromDegrees( 0 ),\n                origin: [ 'center', 'center' ]\n            },\n            // this will contain the last offset position of the image\n            // calculated from traslated origin\n            position: {\n                left: 0,\n                top: 0\n            },\n            rotated: false,\n            width: 0,\n            height: 0,\n            drag: {\n              startX:0,\n              startY:0,\n              dx: 0,\n              dy: 0  \n            },\n            maxRatio: 20\n        };\n\n        // the crop tool\n        this.croppingArea = {\n            // maximum dimensions of the crop tool\n            // crop rectangle cannot be bigger than these values\n            // update with viewport size * aspect ratio\n            maxDimensions: {\n                width: 0,\n                height: 0\n            },\n            // minimum dimensions of the crop tool\n            // crop rectangle cannot be smaller than these values\n            // update with aspect ratio\n            minDimensions: {\n                width: 50,\n                height: 50\n            },\n            // current position of the crop rectangle  \n            position: {\n                top: 0,\n                right: 0,\n                bottom: 0,\n                left: 0\n            },\n            // current dimensions\n            width: 0,\n            height: 0,\n            touched: false\n        };\n\n        this.constrain = false;\n\n        // cache of computed this.imageEditorContainer properties\n        this.outerContainer = {\n            width: 0,\n            height: 0\n        };\n\n        // this will be an ajax call\n        this.imagePath = props.imagePath;\n\n        // container for the original image\n        this.imageObjClone = null;\n\n        // append elements\n        this.container = container;\n\n        // bind class methods to this\n        this.onImageLoaded = this.onImageLoaded.bind( this );\n        this.updateWorkspace = this.updateWorkspace.bind( this );\n        this.onWindowResize = this.onWindowResize.bind( this );\n        this.updateWorkspace = this.updateWorkspace.bind( this );\n        this.onStartDragCropArea = this.onStartDragCropArea.bind( this );\n        this.onDragCropArea = this.onDragCropArea.bind( this );\n        this.onStopDragCropArea = this.onStopDragCropArea.bind( this );\n        this.onStartCropResize = this.onStartCropResize.bind( this );\n        this.onCropResize = this.onCropResize.bind( this );\n        this.onStopCropResize = this.onStopCropResize.bind( this );\n\n\n        // create elements\n        const fragment = document.createDocumentFragment();\n\n        // the image to manipulate\n        this.imageObj = new Image();\n        this.imageObj.setAttribute('crossOrigin', 'anonymous');\n        this.imageObj.className = `${NAMESPACE}__image-layer`;\n        this.imageObj.setAttribute( 'alt', this.imageAltText || IMAGE_ALT_TEXT );\n        this.imageObj.onload = this.onImageLoaded;\n        this.imageObj.onerror = noop;\n\n        // create a clone of the original image\n        this.imageObjClone = this.imageObj.cloneNode(true);\n\n        // this is the offPage workspace\n        // it takes the transformed image, and calculates the positions and ratios required to create output image\n        // https://www.html5rocks.com/en/tutorials/canvas/performance/#toc-pre-render\n        // https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Optimizing_canvas \n        this.canvasWorkspace = createElement( {\n            tagName: 'canvas',\n            className: `${NAMESPACE}__canvas-workspace`\n        } );\n\n        // this is the cropping tool\n        // add the cropping tool and the canvas element\n        this.cropAreaContainer = createElement( {\n            tagName: 'div',\n            className: `${NAMESPACE}__crop-container`,\n            'aria-label': 'Cropping area',\n            children : [\n                {\n                    tagName: 'div',\n                    className: `image-editor__draggable-corner ${NAMESPACE}__draggable-corner-nw`\n                },\n                {\n                    tagName: 'div',\n                    className: `image-editor__draggable-corner ${NAMESPACE}__draggable-corner-ne`\n                },\n                {\n                    tagName: 'div',\n                    className: `image-editor__draggable-corner ${NAMESPACE}__draggable-corner-sw`\n                },\n                {\n                    tagName: 'div',\n                    className: `image-editor__draggable-corner ${NAMESPACE}__draggable-corner-se`\n                },\n                {\n                    tagName: 'span',\n                    className: `image-editor__guide ${NAMESPACE}__guide-horiz-top`\n                },\n                {\n                    tagName: 'span',\n                    className: `image-editor__guide ${NAMESPACE}__guide-horiz-bottom`\n                },\n                this.canvasWorkspace ]\n\n        } );\n\n        // this is the workspace wrapper\n        this.imageEditorWorkspace = createElement( {\n            tagName: 'div',\n            className: `${NAMESPACE}__workspace`,\n            children : [ this.cropAreaContainer, this.imageObj ]\n        } );\n\n        // this is the main container\n        this.imageEditorContainer = createElement( {\n            tagName: 'div',\n            className: `${NAMESPACE}__container ${NAMESPACE}__container-loading`,\n            children : [ this.imageEditorWorkspace ]\n        } );\n\n\n        // add event listeners for dragging\n        // TODO: add helper for multiple event handlers\n        this.cropAreaContainer.addEventListener( 'mousedown', this.onStartDragCropArea );\n        this.cropAreaContainer.addEventListener( 'touchstart', this.onStartDragCropArea, { passive: true } );\n\n        // dragging flag\n        this.dragging = false;\n\n\n        // append elements\n        fragment.appendChild( this.imageEditorContainer );\n        this.container.appendChild( fragment );\n\n        // TODO: requestAnimationFrame to optimize constant coordinate updates\n        this.dragRequestId = null;\n\n        // TODO: these flags are fairly arbitraty now\n        // and are meant to solve immediate dev problems\n        // need review\n        this.resizing = false;\n        this.cropActionTriggered\n\n        this.frameRateInterval = 1000 / 30;\n        this.requestAnimationFrameId = null;\n        this.lastTimestamp = null;\n\n        // callbacks\n        this.onWorkSpaceUpdated = props.onWorkSpaceUpdated;\n\n        // transform matrix defaults\n        this.transformMatrices  = {\n            transformMatrix: [ 1, 0, 0, 1, 0, 0 ],\n            inverseTransformMatrix: [ 1, 0, 0, 1 ]\n        };\n        // load image and prepare workspace\n        this.imageObj.src = this.imagePath;\n\n        return this;\n\n    }\n\n    onImageLoaded() {\n\n        // initial update of coordinates\n        this.updateWorkspace();\n\n        if ( typeof window !== 'undefined' ) {\n              this.lastTimestamp = window.performance.now();\n              window.addEventListener( 'resize', this.onWindowResize );\n        }\n\n        // finally, we show the workspace\n        // place it on the end of the stack to ensure the update takes place first\n        setTimeout( () => {\n            removeClass( this.imageEditorContainer, `${NAMESPACE}__container-loading` );\n        } );\n    }\n\n    onWindowResize() {\n        this.requestAnimationFrameId = window.requestAnimationFrame( this.updateWorkspace );\n    }\n\n    /*\n\n     onStartDragCropArea - main event delegator\n     Since all the interaction takes place on the cropArea,\n     we don't need to assign multiple events to each drag handle and so on\n\n     */\n    onStartDragCropArea( event ) {\n\n        event.preventDefault();\n\n        // if we've hit a drag handle, stop propagation\n        // and throw the event to the crop resize setup method\n        if  ( hasClass( event.target, `${NAMESPACE}__draggable-corner` ) ) {\n            event.stopImmediatePropagation();\n            //this.dragRequestId = window.requestAnimationFrame( this.updateWorkspace );\n\n            // signals to maintain crop dimensions\n            this.croppingArea.touched = true;\n            this.cropAreaContainer.style.transition = 'unset';\n\n            // cache the event\n            this.cropEvent = event;\n\n            this.onStartCropResize( event );\n            return false;\n        }\n\n        // otherwise we're free to drag the image\n        this.imageEditorContainer.addEventListener( 'mouseup', this.onStopDragCropArea );\n        this.imageEditorContainer.addEventListener( 'touchend', this.onStopDragCropArea );\n        this.imageEditorContainer.addEventListener( 'mouseleave', this.onStopDragCropArea );\n\n        const mousePos = getMousePosition( event, this.imageEditorContainer );\n\n        // we're translating the image so we have to know the delta position\n        // the start position is the mouse position - the last known position\n        this.image.drag.startX = mousePos.x - this.image.transform.translateX;\n        this.image.drag.startY = mousePos.y - this.image.transform.translateY;\n\n        // drag the image\n        document.addEventListener( 'mousemove', this.onDragCropArea );\n        document.addEventListener( 'touchmove', this.onDragCropArea, { passive: true } );\n    }\n\n\n    onDragCropArea( event ) {\n\n        this.dragging = true;\n        const mousePos = getMousePosition( event, this.imageEditorContainer );\n\n        let newDx = mousePos.x - this.image.drag.startX;\n        let newDy = mousePos.y - this.image.drag.startY;\n\n        if ( this.image.width > this.croppingArea.width && \n            this.image.height > this.croppingArea.height\n            && newDx <= this.croppingArea.position.left\n            && newDy <= this.croppingArea.position.top\n            && (-1 * newDy) + this.croppingArea.height <= this.image.height\n            && newDx >=  this.croppingArea.width - this.image.width ) {\n\n\n            this.transformMatrices = {\n                ...createTransformMatrix( \n                    this.transformMatrices.transformMatrix, \n                    this.transformMatrices.inverseTransformMatrix, \n                    newDx, \n                    newDy, \n                    this.image.transform.scale,\n                    this.image.transform.radians \n                )\n            };\n\n            this.imageObj.style.transform = `matrix(    \n                ${this.transformMatrices.transformMatrix[0]}, \n                ${this.transformMatrices.transformMatrix[1]}, \n                ${this.transformMatrices.transformMatrix[2]}, \n                ${this.transformMatrices.transformMatrix[3]}, \n                ${this.transformMatrices.transformMatrix[4]}, \n                ${this.transformMatrices.transformMatrix[5]})`;\n\n            // save the last known offset\n            // TODO: we can create some internal reducer-like methods to manage this state\n            this.image.drag = Object.assign( {},  this.image.drag, {\n                dx: newDx,\n                dy: newDy\n            });\n        }\n   }\n\n    onStopDragCropArea() {\n            this.dragging = false;\n            document.removeEventListener( 'mousemove', this.onDragCropArea );\n            document.removeEventListener( 'touchmove', this.onDragCropArea, { passive: true } );\n\n            this.image.transform = Object.assign( {}, this.image.transform, {\n                translateX: this.image.drag.dx,\n                translateY: this.image.drag.dy\n            } );\n\n            this.drawImage();\n        }\n\n\n    onStartCropResize ( event ) {\n\n          this.dragging = true;\n\n          event.preventDefault();\n\n          document.addEventListener( 'touchmove', this.onCropResize );\n          document.addEventListener( 'touchend', this.onStopCropResize );\n          document.addEventListener( 'mousemove', this.onCropResize );\n          document.addEventListener( 'mouseup', this.onStopCropResize );\n\n          this.mousePos = {\n              x: 0,\n              y: 0\n          };\n    }\n\n    onCropResize ( event ) {\n\n        this.mousePos = getMousePosition( event, this.imageEditorContainer );\n        // first check the mouse boundaries\n        // now calculate the new dimensions of the crop area\n        let width, height, left, top, right, bottom;\n\n        if ( this.cropEvent.target.classList.contains( `${NAMESPACE}__draggable-corner-se` ) ) {\n              width  = this.mousePos.x - this.croppingArea.position.left;\n              height = this.mousePos.y - this.croppingArea.position.top;\n              left = this.croppingArea.position.left;\n              top = this.croppingArea.position.top;\n\n              // origin of image scale should be set to the opposite corner of this handle\n              this.image.transform.origin = [ 'left', 'top' ];\n        }\n\n        if ( this.cropEvent.target.classList.contains( `${NAMESPACE}__draggable-corner-sw` ) ) {\n\n              width  = this.croppingArea.width - ( this.mousePos.x - this.croppingArea.position.left );\n              height = this.mousePos.y - this.croppingArea.position.top;\n              left = this.mousePos.x;\n              top = this.croppingArea.position.top;\n\n              // origin of image scale should be set to the opposite corner of this handle\n              this.image.transform.origin = [ 'right', 'top' ];\n\n        }\n\n        if ( this.cropEvent.target.classList.contains( `${NAMESPACE}__draggable-corner-nw` ) ) {\n\n              width = this.croppingArea.width - ( this.mousePos.x - this.croppingArea.position.left );\n              height = this.croppingArea.height - ( this.mousePos.y - this.croppingArea.position.top );\n              left = this.mousePos.x;\n              top = this.mousePos.y ;\n              if ( this.constrain || event.shiftKey ) {\n                  top = this.mousePos.y - ( ( width / this.image.width * this.image.height ) - height );\n              }\n\n              // origin of image scale should be set to the opposite corner of this handle\n              this.image.transform.origin = [ 'right', 'bottom' ];\n\n        }\n\n        if ( this.cropEvent.target.classList.contains( `${NAMESPACE}__draggable-corner-ne` ) ) {\n\n              width = ( this.mousePos.x - this.croppingArea.position.left );\n              height = this.croppingArea.height - ( this.mousePos.y - this.croppingArea.position.top );\n              left = this.croppingArea.position.left;\n              top = this.mousePos.y ;\n              if ( this.constrain || event.shiftKey ) {\n                  top = this.mousePos.y - ( (width / this.image.width * this.image.height ) - height );\n              }\n\n              // origin of image scale should be set to the opposite corner of this handle\n              this.image.transform.origin = [ 'left', 'bottom' ];\n\n        }\n\n        if ( this.constrain || event.shiftKey ) {\n            height = width / this.image.width * this.image.height;\n        }\n\n        // only apply the new dimensions if fall within the min and max values\n        // this needs to be updated depending on the\n        // TODO: the box is sticky when it hits the extremities, and won't resize\n        if ( width >= this.croppingArea.minDimensions.width\n            && height >= this.croppingArea.minDimensions.height\n            && width < this.croppingArea.maxDimensions.width\n            && height < this.croppingArea.maxDimensions.height ) {\n\n            // zoom out diagonally\n            this.zoomOut = false;\n            this.cropActionTriggered = true;\n\n            if ( width > this.croppingArea.width && height > this.croppingArea.height )  {\n            this.zoomOut = true;\n            }\n\n\n            this.croppingArea.width = width;\n            this.croppingArea.height = height;\n             bottom = this.image.height - top - this.croppingArea.height;\n                 right = this.image.width - left - this.croppingArea.width;\n\n            this.croppingArea.position = {\n                top: top >= 0 ? top : 0,\n                right: right >= 0 ? right : 0,\n                bottom: bottom >= 0 ? bottom : 0,\n                left: left >= 0 ? left : 0\n            };\n            this.cropAreaContainer.style.width =  `${ this.croppingArea.width }px`;\n            this.cropAreaContainer.style.height = `${ this.croppingArea.height }px`;\n            this.cropAreaContainer.style.left = `${ this.croppingArea.position.left  }px`;\n            this.cropAreaContainer.style.top = `${ this.croppingArea.position.top }px`;\n\n             if (this.zoomOut)   {\n                this.zoomOutImage() ;\n             }\n        } \n\n\n\n    }\n\n    onStopCropResize () {\n\n        this.dragging = false;\n        this.mousePos = null;\n        this.cropEvent = null;\n        document.removeEventListener( 'mousemove', this.onCropResize );\n        document.removeEventListener( 'mouseup', this.onStopCropResize );\n\n        document.removeEventListener( 'touchmove', this.onCropResize );\n        document.removeEventListener( 'touchend', this.onStopCropResize );\n        this.cropAreaContainer.style.transition = 'all 0.09s linear';\n\n        if (!this.cropActionTriggered) {\n          return;\n        }\n\n        this.cropActionTriggered = false;\n\n        // are we zooming out?\n        // TODO: implement this\n        if (this.zoomOut) {\n            this.zoomOut = false;\n            this.croppingArea.scale = {\n                width: this.croppingArea.width / this.image.width,\n                height: this.croppingArea.height / this.image.height,\n                top: this.croppingArea.position.top / this.image.height ,\n                left: this.croppingArea.position.left / this.image.width\n            };\n        } else {\n            this.zoomInImage();\n        }\n\n        this.drawImage();\n    }\n\n    zoomInImage() {\n\n         // get aspect ratio of to-be-resized crop area\n        const scaleRatio = calculateAspectRatioFit(\n              this.croppingArea.width,\n              this.croppingArea.height,\n              this.outerContainer.width,\n              this.outerContainer.height,\n              this.image.rotated,\n              EDITOR_GUTTER );\n\n\n       \n        const scale = this.image.transform.scale * scaleRatio.ratio;\n        \n        if (scale >= this.image.maxRatio) {\n            return;\n        }\n        const translateY =  (-1 * (this.croppingArea.position.top * scaleRatio.ratio ))\n              + (this.image.transform.translateY * scaleRatio.ratio);\n        const translateX =  (-1 * (this.croppingArea.position.left * scaleRatio.ratio ))\n              + (this.image.transform.translateX * scaleRatio.ratio);\n\n        this.transformMatrices = {\n            ...createTransformMatrix( \n                this.transformMatrices.transformMatrix, \n                this.transformMatrices.inverseTransformMatrix, \n                // play with this\n                translateX, \n                translateY, \n                scale,\n                this.image.transform.radians \n                )\n        };\n\n        this.imageObj.style.transform = `matrix(    \n            ${this.transformMatrices.transformMatrix[0]}, \n            ${this.transformMatrices.transformMatrix[1]}, \n            ${this.transformMatrices.transformMatrix[2]}, \n            ${this.transformMatrices.transformMatrix[3]}, \n            ${this.transformMatrices.transformMatrix[4]}, \n            ${this.transformMatrices.transformMatrix[5]})`;\n\n        this.image.width = this.image.width * scaleRatio.ratio;\n        this.image.height = this.image.height * scaleRatio.ratio;\n\n        this.croppingArea.maxDimensions = {\n            width: this.image.width >= this.outerContainer.width ? this.outerContainer.width : this.image.width,\n            height: this.image.height >= this.outerContainer.height ? this.outerContainer.height : this.image.height\n        };\n\n        this.croppingArea.width = scaleRatio.width >= this.croppingArea.maxDimensions.width ? this.croppingArea.maxDimensions.width : scaleRatio.width;\n        this.croppingArea.height = scaleRatio.height >= this.croppingArea.maxDimensions.height ? this.croppingArea.maxDimensions.height : scaleRatio.height;\n        \n        this.croppingArea.position.top = 0;\n        this.croppingArea.position.left =  0 ;\n\n        this.cropAreaContainer.style.left = `${ this.croppingArea.position.left   }px`;\n        this.cropAreaContainer.style.top = `${ this.croppingArea.position.top  }px`;\n        this.cropAreaContainer.style.width =  `${ this.croppingArea.width  }px`;\n        this.cropAreaContainer.style.height =  `${ this.croppingArea.height  }px`;\n\n        this.croppingArea.scale = {\n            width: this.croppingArea.width / this.image.width,\n            height: this.croppingArea.height / this.image.height,\n            top: this.croppingArea.position.top / this.image.height ,\n            left: this.croppingArea.position.left / this.image.width,\n        };\n  \n \n        this.image.transform = Object.assign( {}, this.image.transform, {\n            translateX,\n            translateY,\n            scale\n        } );\n\n        this.drawImage();\n\n    }\n\n\n    // TODO: zoom out when pulling the draggable corners\n    zoomOutImage() {\n       console.log('zoom out!!!');\n    }\n\n\n    // update the positions and dimensions\n    // when the workspace changes\n    updateWorkspace( timestamp ) {\n\n      const now = timestamp,\n          elapsedTime = now - this.lastTimestamp;\n\n        if ( elapsedTime < this.frameRateInterval ) {\n          return;\n        }\n\n        // if enough time has passed to call the next frame\n        // reset lastTimeStamp minus 1 frame in ms ( to adjust for frame rates other than 60fps )\n        this.lastTimestamp = now - ( elapsedTime % this.frameRateInterval );\n\n        // cache the container offset width\n        this.outerContainer.width = this.imageEditorContainer.offsetWidth;\n        this.outerContainer.height = this.imageEditorContainer.offsetHeight;\n\n        let scaleRatio;\n        \n        // if nothing has been touched, size the image to the workspace\n        if ( ! this.croppingArea.touched ) {\n            // get aspect ratio\n            scaleRatio = calculateAspectRatioFit(\n                  this.imageObj.naturalWidth,\n                  this.imageObj.naturalHeight,\n                  this.outerContainer.width,\n                  this.outerContainer.height,\n                  this.image.rotated,\n                  EDITOR_GUTTER );\n            \n            // apply the initial dimensions to the image      \n            this.image.width = scaleRatio.width;\n            this.image.height = scaleRatio.height;\n            this.image.transform.scale = scaleRatio.ratio;\n            \n            // apply them to the cropping area\n            this.croppingArea.height = this.image.height;\n            this.croppingArea.width = this.image.width;\n            this.croppingArea.position = {\n                top:  0,\n                right: this.image.width,\n                bottom: this.image.height,\n                left: 0\n            };\n\n        // else the ratio we care about is the resized cropping area \n        } else {\n            scaleRatio = calculateAspectRatioFit(\n                  this.croppingArea.width,\n                  this.croppingArea.height,\n                  this.outerContainer.width,\n                  this.outerContainer.height,\n                  this.image.rotated,\n                  EDITOR_GUTTER );\n\n\n            this.image.width = this.image.width * scaleRatio.ratio;\n            this.image.height = this.image.height * scaleRatio.ratio;       \n            this.image.transform.scale = this.image.transform.scale * scaleRatio.ratio;\n\n            this.croppingArea.width = this.croppingArea.scale.width * this.image.width;\n            this.croppingArea.height = this.croppingArea.scale.height * this.image.height;\n            this.croppingArea.position.top = ( this.croppingArea.scale.top * this.image.height );\n            this.croppingArea.position.left =  ( this.croppingArea.scale.left * this.image.width);\n        }\n\n      // TODO: this is not exactly right. \n      // translateX is constantly updated, so we need to apply the correct ratio when scaling\n      // haven't worked that out yet  \n      this.image.transform = Object.assign( {}, this.image.transform, {\n          translateX: this.image.transform.translateX * scaleRatio.ratio,\n          translateY: this.image.transform.translateY *  scaleRatio.ratio\n      } );\n\n      // set the image transform matrix\n      this.transformMatrices = {\n          ...createTransformMatrix( \n              this.transformMatrices.transformMatrix, \n              this.transformMatrices.inverseTransformMatrix, \n              this.image.transform.translateX, \n              this.image.transform.translateY, \n              this.image.transform.scale,\n              this.image.transform.radians \n              )\n      };\n\n      // apply the matrix to the image \n      this.imageObj.style.transform = `matrix(    \n          ${this.transformMatrices.transformMatrix[0]}, \n          ${this.transformMatrices.transformMatrix[1]}, \n          ${this.transformMatrices.transformMatrix[2]}, \n          ${this.transformMatrices.transformMatrix[3]}, \n          ${this.transformMatrices.transformMatrix[4]}, \n          ${this.transformMatrices.transformMatrix[5]})`;\n\n        // resize the cropping area\n        this.cropAreaContainer.style.left = `${ this.croppingArea.position.left   }px`;\n        this.cropAreaContainer.style.top = `${ this.croppingArea.position.top  }px`;\n        this.cropAreaContainer.style.width =  `${ this.croppingArea.width  }px`;\n        this.cropAreaContainer.style.height =  `${ this.croppingArea.height  }px`;\n\n        // reset the cropping area's limits\n        this.croppingArea.maxDimensions = {\n            width: this.image.width >= this.outerContainer.width ? this.outerContainer.width : this.image.width,\n            height: this.image.height >= this.outerContainer.height ? this.outerContainer.height : this.image.height\n        };\n\n        // draw to canvas\n        // TODO: we don't actually have to do this at all until the final save\n        this.drawImage();\n\n    }\n\n\n    // TODO: at the moment we're calling this after every image transformation\n    // in fact, because we're keeping track of the transforms, we don't need to call it at all until the end\n    // it's just for the preview\n    drawImage() {\n\n        const context = this.canvasWorkspace.getContext('2d');\n        const rotated = this.image.rotated;\n\n       \n        const scaledCropWidth = Math.floor( ( this.croppingArea.width / this.image.transform.scale  ) );\n        const scaledCropHeight = Math.floor( ( this.croppingArea.height / this.image.transform.scale  ) );\n\n\n\n        this.canvasWorkspace.width = scaledCropWidth;\n        this.canvasWorkspace.height =  scaledCropHeight;\n\n        context.clearRect( 0, 0, scaledCropWidth / 2, scaledCropWidth / 2  );\n\n        // TODO\n        if ( rotated ) {\n            // origin of the canvas rotate is the middle\n            // context.translate( this.canvasWorkspace.width / 2, this.canvasWorkspace.width / 2 );\n            // context.rotate( this.image.transform.radians );\n        }\n        \n\n        context.save();\n\n\n        // invert the matrix and get the original coords \n        // from the top, left  of the cropping tool\n        const sourceCoords = getOriginalCoordinatesFromTransformedMatrix( \n            this.transformMatrices.transformMatrix, \n            this.transformMatrices.inverseTransformMatrix,\n            this.croppingArea.position.left,\n            this.croppingArea.position.top\n        );\n\n        // this is where and how far we want to crop the original image\n        const sourceX = sourceCoords.x,\n              sourceY = sourceCoords.y,\n              sourceWidth = scaledCropWidth,\n              sourceHeight = scaledCropHeight;\n\n        // get the destination x, y\n        const destX = 0,\n              destY = 0,\n\n        // the cropped area\n            destWidth = scaledCropWidth,\n            destHeight = scaledCropHeight;\n\n\n        // now draw!    \n        context.drawImage(\n            this.imageObj,\n            // x, y coordinate of the top left corner of the sub-rectangle of the source image to draw into the destination context.\n            sourceX, sourceY,\n            // w and h of the sub-rectangle of the source image to draw into the destination context.\n            sourceWidth, sourceHeight,\n            // x, y coordinates in the destination canvas at which to place the top-left corner of the source image.\n            destX, destY,\n            // w and h of the image in the destination canvas. Changing these values scales the sub-rectangle in the destination context.\n            destWidth, destHeight );\n\n        context.restore();\n\n        if ( DEBUG ) {\n\n            this.onWorkSpaceUpdated( {\n                canvas: this.canvasWorkspace,\n                original: {\n                    width: this.imageObj.naturalWidth,\n                    height: this.imageObj.naturalHeight\n                },\n                cropped: {\n                    width: scaledCropWidth,\n                    height: scaledCropHeight,\n                    rotated: rotated\n                }\n            } );\n        }  \n    }\n\n    rotate( degrees ) {\n        // TODO: check if one of 90/180/270\n        this.image.transform.degrees = degrees;\n        this.image.transform.radians = getRadianFromDegrees( degrees );\n        this.image.rotated = ! ( ( this.image.transform.degrees % 180 ) === 0 );\n        this.updateWorkspace();\n    }\n\n    // ==== editing API\n    // rotate( callback ) // returns new coords\n    // reflect( callback ) // returns new coords\n    // changeAspectRatio( callback ) // returns new coords\n    // save() // returns blob\n    // preview() // returns image/png for optional preview before save\n    // reset( callback )\n    // onImageLoaded( callback ) // allows consumers to do something after bootstrap\n    // destroy () clear container and remove all event listeners\n    // getOriginalImage() // returns original image\n    // getWorkingImage() // returns image at current crop state\n\n\n}\n\n\n// WEBPACK FOOTER //\n// ./src/image-editor.js","/**\n * Create a noop call\n * @returns {Function}\n */\nexport function noop() {\n    setTimeout( Function.prototype, 10000 );\n}\n\n/**\n * Throttle a func call every {threshhold}ms\n * https://developer.mozilla.org/en-US/docs/Web/Events/resize\n * Usage:\n    throttle(\"resize\", \"optimizedResize\");\n    // handle event\n    window.addEventListener(\"optimizedResize\", function() {\n        console.log(\"Resource conscious resize callback!\");\n    });\n */\nexport function throttle( type, name, obj = window ) {\n    let running = false;\n    const func = function() {\n        if (running) { return; }\n        running = true;\n        requestAnimationFrame(function throttledRequestAnimationFrame() {\n            obj.dispatchEvent( new CustomEvent( name ) );\n            running = false;\n        });\n    };\n    obj.addEventListener(type, func);\n}\n\n/**\n * Creates a simple DOM tree\n * @example\nconst htmlElementToAppend = createElement({\n  tagName: 'span',\n  className: 'new-class-name',\n  text: 'Spannend!',\n  attributes: {\n    'title': 'Geil!'\n  },\n  children: [{ \n      // recursive call to createElement()\n  }]\n})); // returns => <span class=\"new-class-name\" title=\"Geil!\">Spannend!</span>\n * @typedef {Object} OptionsObject\n * @property {String} tagName\n * @property {String} className\n * @property {String} text\n * @property {Object} attributes\n * @property {Array<options>} children\n * \n * @param {OptionsObject} options\n * @returns {HTMLElement}\n */\nexport function createElement( options ) {\n\n    const element = document.createElement( options.tagName );\n\n    if ( options.className ) {\n        element.className = options.className;\n    }\n\n    if ( options.attributes ) {\n        for ( let attr in options.attributes ) {\n            element.setAttribute( attr, options.attributes[attr] )\n        }\n    }\n\n    if ( options.text ) {\n        element.appendChild( document.createTextNode( options.text ) );\n    }\n\n    if ( options.children && options.children.length ) {\n        let i = 0;\n        let childrenLength = options.children.length;\n        for (; i < childrenLength; i++ ) {\n            element.appendChild( options.children[i] instanceof window.HTMLElement ? options.children[i] : createElement( options.children[i] ) );\n        }\n    }\n\n    return element;\n\n}\n\n/**\n * @example\n const offsetValues = getOffsetRelativeToParent(\n    '.child-selector',\n    '#parent-selector'\n ); // returns => { top: {n}, right: {n}, bottom: {n}, left: {n} }\n * @typedef {Object} OffsetObject\n * @property {Integer} top\n * @property {Integer} right\n * @property {Integer} bottom\n * @property {Integer} left\n *\n * @param {String} childCssSelector\n * @param {String} parentCssSelector\n * @returns {OffsetObject}\n */\nexport function getOffsetRelativeToParent( childCssSelector, parentCssSelector) {\n\n    // we have to query the DOM elements to get the latest position data\n    // in case there has been a CSS transform on the element(s)\n    const childElem = document.querySelector( childCssSelector );\n    const parentElem = document.querySelector( parentCssSelector );\n\n    if ( ! childElem || ! parentElem ) {\n        throw new Error( `One or more DOM elements can't be found with: ${childCssSelector} or ${parentCssSelector}` );\n    }\n\n    const childRect = childElem.getBoundingClientRect();\n    const parentRect = parentElem.getBoundingClientRect();\n\n    return {\n        top: childRect.top - parentRect.top,\n        right: childRect.right - parentRect.right,\n        bottom: childRect.bottom - parentRect.bottom,\n        left: childRect.left - parentRect.left\n    };\n\n}\n\n/**\n * @example\n const offsetValues = getCenterPositionRelativeToParent(\n    HTMLElement,\n    HTMLElement.parentNode\n ); // returns => { left: {n}, top: {n} }\n * @typedef {Object} CenterPosition\n * @property {Integer} top\n * @property {Integer} left\n *\n * @param {HTMLElement} childElement\n * @param {HTMLElement} parentElement\n * @returns {CenterPosition}\n */\nexport function getCenterPositionRelativeToParent( childElement, parentElement ) {\n    return {\n        left: ( parentElement.offsetWidth / 2 - childElement.offsetWidth / 2 ),\n        top: ( parentElement.offsetHeight / 2 - childElement.offsetHeight / 2 )\n    };\n}\n\n/**\n * @example\n const mousePos = getMousePosition(\n    DOMEventObject,\n    HTMLElement\n ); // returns => { x: {n}, y: {n} }\n * @typedef {Object} PositionObject\n * @property {Integer} x\n * @property {Integer} y\n *\n * @param {DOMEventObject} event\n * @param {HTMLElement} contextElement (optional if you need position relative to parent offset)\n * @returns {PositionObject}\n */\nexport function getMousePosition( event, contextElement = null ) {\n\n    const offsetLeft = contextElement ? contextElement.offsetLeft : window.pageXOffset;\n    const offsetTop = contextElement ? contextElement.offsetTop : window.pageYOffset;\n\n    const x = ( event.pageX || event.touches[0].pageX ) - offsetLeft;\n    const y = ( event.pageY || event.touches[0].pageY ) - offsetTop;\n\n    return {\n        x,\n        y\n    };\n}\n\n\n/**\n * Conserve aspect ratio of the orignal region. Useful when shrinking/enlarging\n * images to fit into a certain area.\n * At the moment we expect rotations of only 90 degrees.\n * This could be improved by always checking if the bounding box of a rotated rectangle fits within the scaled container\n *\n * @param {Number} srcWidth Source area width\n * @param {Number} srcHeight Source area height\n * @param {Number} maxWidth Fittable area maximum available width\n * @param {Number} maxHeight Fittable area maximum available height\n * @param {Boolean} rotated\n * @param {Number} gutter - Optional percentage to increase or decrease the new fit dimensions\n * @return {Object} { width, heigth }\n */\nexport function calculateAspectRatioFit( srcWidth, srcHeight, maxWidth, maxHeight, rotated = false, gutter = 1 ) {\n\n    const aspectRatio = rotated ? Math.min( maxHeight / srcWidth, maxWidth / srcHeight ) : Math.min( maxWidth / srcWidth, maxHeight / srcHeight );\n    // reduce ratio to gutter percentage amount\n    const ratio = aspectRatio * gutter;\n\n    // widths with ratio applied\n    const width = Math.floor( srcWidth * ratio ) ;\n    const height = Math.floor( srcHeight * ratio ) ;\n\n    return {\n        ratio,\n        width,\n        height\n    };\n}\n\nexport function calculateOriginalDimensionsFromScaled( scaledWidth, scaledHeight, ratio ) {\n\n    // widths with ratio applied\n    const width = Math.floor( scaledWidth / ratio ) ;\n    const height = Math.floor( scaledHeight / ratio ) ;\n\n    return {\n        width,\n        height\n    };\n}\n\nexport function transformCSS( element, translateX = 0, translateY = 0, scale = 0, radians = 0 ) {\n    element.style.transform = `translate( ${ translateX }px, ${ translateY }px ) scale( ${ scale } ) rotate( ${ radians }rad ) translateZ( 0px )`;\n    return element;\n}\n\n// Converts from degrees to radians.\nexport function getRadianFromDegrees( degrees ) {\n    return degrees * Math.PI / 180;\n}\n\n// Converts from radians to degrees.\nexport function getDegreesFromRadians( radians ) {\n    return radians * 180 / Math.PI;\n}\n\nexport function regExp( name ) {\n    return new RegExp( `(^| )${name}( |$)` );\n}\n\nexport function hasClass( element, className ) {\n    if ( ! ( 'classList' in Element.prototype )  ) {\n        return regExp( name ).test( this.element.className );\n    }\n    return element.classList.contains( className );\n}\n\nexport function removeClass( element, className ) {\n    if ( ! ( 'classList' in Element.prototype ) ) {\n        return element.className =  element.className.replace( regExp( name ), '' );\n    }\n    return element.classList.remove( className );\n}\n\nexport function createTransformMatrix( transformMatrix, inverseTransformMatrix, x, y, scale, rotate ) {\n\n    // create the rotation and scale parts of the transformMatrix\n    transformMatrix[3] =   transformMatrix[0] = Math.cos(rotate) * scale;\n    transformMatrix[2] = -(transformMatrix[1] = Math.sin(rotate) * scale);\n\n    // add the translation\n    transformMatrix[4] = x;\n    transformMatrix[5] = y;\n\n    // calculate the inverse transformation\n\n    // first get the cross product of x axis and y axis\n    var cross = transformMatrix[0] * transformMatrix[3] - transformMatrix[1] * transformMatrix[2];\n\n    // now get the inverted axis\n    inverseTransformMatrix[0] =  transformMatrix[3] / cross;\n    inverseTransformMatrix[1] = -transformMatrix[1] / cross;\n    inverseTransformMatrix[2] = -transformMatrix[2] / cross;\n    inverseTransformMatrix[3] =  transformMatrix[0] / cross;\n    \n\n    return {\n        transformMatrix,\n        inverseTransformMatrix\n    };\n};\n\n// params: x, y coords in current, transformed matrix\n// returns x,y coords from original, untransformed matrix\nexport function getOriginalCoordinatesFromTransformedMatrix( transformMatrix, inverseTransformMatrix, x, y ) {\n    var xx, yy;\n    xx = x - transformMatrix[4];     // remove the translation\n    yy = y - transformMatrix[5];     // by subtracting the origin\n    // return the point {x:?,y:?} by multiplying xx,yy by the inverse matrix\n    return {\n        x:   xx * inverseTransformMatrix[0] + yy * inverseTransformMatrix[2],\n        y:   xx * inverseTransformMatrix[1] + yy * inverseTransformMatrix[3]\n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/utils.js"],"sourceRoot":""}